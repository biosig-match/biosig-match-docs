# UI/UX Design Document

## 1. 全体コンセプト

- **テーマ**: ダークモードを基調とし、黒や濃い灰色を背景に、アクセントカラーとして水色を使用。ミニマルで先進的な印象を与え、長時間の利用でも目が疲れにくいデザインを目指す。
- **フォント・アイコン**: テキストやグラフの軸ラベルは白で見やすさを確保。アイコンはシンプルで直感的に理解できるものを使用する。
- **ナビゲーション**: 主要画面へは、画面左上に配置するハンバーガーメニューから遷移する。

---

## 2. 画面構成

アプリケーションは、主に以下の 4 つの画面で構成される。

1.  **ホーム画面 (Home)**: アプリのメイン画面。生体データのリアルタイム表示と、計測のコントロールを行う。
2.  **実験一覧画面 (Experiments)**: 参加する実験の選択や、新しい実験の作成を行う。
3.  **解析画面 (Analysis)**: サーバーで準リアルタイムに解析された結果（PSD, Coherence）を表示する。
4.  **セッション終了画面 (Session Summary)**: 計測したセッションの情報を確認し、イベント CSV のアップロードなどを行う。

---

## 3. 各画面の詳細

### 3.1. ホーム画面

- **表示要素**:
  - **コントロールボタン**:
    - **セッション開始/終了ボタン**:
      - **開始時**: タップすると、**「セッションモード選択」ダイアログ**が表示される。

### 3.2. 実験一覧画面

- **目的**: 実験を管理し、**実験の設計**を行うための入り口。
- **表示要素**:
  - (ヘッダー, 実験リストは同様)
  - **各実験項目の操作**:
    - タップ: その実験を選択状態にする。
    - **「設計」ボタン**: 各実験項目の横に歯車やペンのアイコンを配置。タップすると**「実験設計画面」**に遷移する。

### 3.3. 実験設計画面

- **目的**: モードを問わず、使用する刺激アセット（イベントリストと画像ファイル）をサーバーに登録する。
- **表示要素**:
  - **ヘッダー**: 「実験設計: {実験名}」
  - **刺激ファイルアップロードエリア**: -　刺激が画像か音声か選択するボタン。
    - 「{画像 / 音声}ファイル（複数可）を選択」ボタン。
    - 選択されたファイルのサムネイルとファイル名のリスト。ドラッグで順番を並び替え、刺激の提示順を決められる。
    - 刺激をランダム提示するかどうか選択するトグル。
  - **「登録」ボタン**: タップすると、ファイル群を`Session Manager`に送信する。

### 3.4. セッション終了画面

- **目的**: 記録したセッションの最終処理を行う。**Hybrid モードの場合は、外部生成されたイベントログをアップロードする。**
- **表示要素**:
  - (セッション時間等の表示は変更なし)
  - **イベントログ アップロードエリア**:
    - **Hybrid モードで実行されたセッションの場合のみ表示される。**
    - 「イベントログ (CSV) を選択」ボタンを配置。
    - 選択されたファイル名を表示。
  - **「完了」ボタン**: タップすると、セッション情報と、All-in-One モードではアプリが生成したイベントログ CSV が、Hybrid モードではユーザーが選択したイベントログ CSV が`Session Manager`に送信される。

---

## 4. UI/UX フロー

### 実験設計フロー (NEW - All-in-One モード用)

1.  **実験選択**: ユーザーは「実験一覧」画面で、設計したい実験の「設計」ボタンをタップ。
2.  **設計画面へ**: 「実験設計画面」に遷移する。
3.  **アセット登録**: ユーザーは刺激定義 CSV と、対応する全ての画像ファイルを選択し、「登録」ボタンをタップ。
4.  **完了**: サーバーでの検証・登録が完了すると、成功メッセージが表示され、「実験一覧」画面に戻る。

### セッション開始フロー (UPDATED)

1.  **実験選択**: ユーザーはホーム画面で計測したい実験を選択。
2.  **BLE 接続**: BLE デバイスに接続。計測開始。
3.  **セッションモード選択**: 「セッション開始」ボタンをタップするとダイアログが表示される。
    - **「アプリで刺激提示 (All-in-One)」**
    - **「外部アプリで刺激提示 (Hybrid)」**
4.  **セッション開始**: ユーザーが選択したファイルが順に提示される。将来このアプリにはユーザーの日常シーンと脳波の関係を導く巨大なデータセットを作り出す責務があるため、スマホカメラあるいはスクリーンショットによる定期的な撮影と継続的な録音が開始される。

### セッション終了フロー (UPDATED)

1.  **計測終了**: ユーザーが「セッション終了」ボタンをタップ。セッション終了画面に遷移。
2.  **最終処理**:
    - **All-in-One モード**: ユーザーは内容を確認し、「完了」ボタンをタップ。
    - **Hybrid モード**: ユーザーは PC 等から転送した**実績イベントログ CSV**を選択し、「完了」ボタンをタップ。
3.  **完了**: アプリは必要な情報を`Session Manager`に送信し、ホーム画面に戻る。
