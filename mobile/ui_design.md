# UI/UX Design Document

## 1. 全体コンセプト

- **テーマ**: ダークモードを基調とし、黒や濃い灰色を背景に、アクセントカラーとして水色を使用。ミニマルで先進的な印象を与え、長時間の利用でも目が疲れにくいデザインを目指す。
- **フォント・アイコン**: テキストやグラフの軸ラベルは白で見やすさを確保。アイコンはシンプルで直感的に理解できるものを使用する。
- **ナビゲーション**: 主要画面へは、画面左上に配置するハンバーガーメニューから遷移する。

---

## 2. 画面構成

アプリケーションは、主に以下の 4 つの画面で構成される。

1.  **ホーム画面 (Home)**: アプリのメイン画面。生体データのリアルタイム表示と、計測のコントロールを行う。
2.  **実験一覧画面 (Experiments)**: 参加する実験の選択や、新しい実験の作成を行う。
3.  **解析画面 (Analysis)**: サーバーで準リアルタイムに解析された結果（PSD, Coherence）を表示する。
4.  **セッション終了画面 (Session Summary)**: 計測したセッションの情報を確認し、イベント CSV のアップロードなどを行う。

---

## 3. 各画面の詳細

### 3.1. ホーム画面

- **目的**: 生データの状態を視覚的に確認し、セッションの開始・終了を直感的に操作する。
- **表示要素**:
  - **ヘッダー**: ハンバーガーメニューアイコン(左上)、アプリタイトル、BLE 接続ステータスアイコン(右上)。
  - **実験情報エリア**: 現在選択中の実験名を表示。「変更」ボタンを併設し、タップすると実験一覧画面に遷移する。実験が未選択の場合は「実験を選択してください」と表示。
  - **生波形チャート**: 8 チャンネルの脳波データをリアルタイムに描画。波形は水色。
  - **快・不快チャート**: リアルタイムに解析された快・不快度（Valence など）の時系列グラフ。快（Valence > 0）を暖色系（オレンジ）、不快（Valence < 0）を寒色系（紫）などで色分けし、直感的に理解しやすくする。
  - **コントロールボタン**:
    - **BLE 接続/切断ボタン**: デバイスとの接続状態に応じてトグルする。
    - **セッション開始/終了ボタン**: 実験が選択されている場合に有効化。
      - **開始時**: 緑色で「セッション開始」。
      - **計測中**: 赤色で「セッション終了」。

### 3.2. 実験一覧画面

- **目的**: 過去の実験を参照し、次のセッションで記録する実験を管理する。
- **表示要素**:
  - **ヘッダー**: 「実験一覧」というタイトルと、新規作成ボタン（"+"アイコン）。
  - **実験リスト**:
    - 自分が作成、または参加した実験がリスト形式で表示される。
    - 各項目には実験名、作成日、説明文の一部などを表示。
    - **現在選択中の実験は、背景色を変えたり、「選択中」というバッジを付けたりして明確に区別する。**
  - **操作**:
    - リストの項目をタップすると、その実験が「選択中」の状態になり、ホーム画面に反映される。
    - 新規作成ボタンをタップすると、実験名、説明、公開設定（Public/Private）などを入力するダイアログが表示される。

### 3.3. 解析画面

- **目的**: サーバーサイドでの解析結果を視覚的に確認する。
- **動作**:
  - **データ取得**: この画面が表示された時のみ、`AnalysisProvider`がポーリングを開始し、解析結果画像（PSD、Coherence）を`Realtime Analyzer Service`から取得する。画面が非表示になったらポーリングを停止し、不要な通信を防ぐ。
- **表示要素**:
  - タブ UI を採用し、「パワースペクトル」「コヒーレンス」を切り替えて表示。
  - 各タブ内には、Base64 でエンコードされた画像データをデコードして表示する。

### 3.4. セッション終了画面

- **目的**: 記録したセッションの最終処理を行う。
- **表示要素**:
  - セッションの開始時刻、終了時刻、継続時間を表示。
  - **イベントリストアップロードエリア**:
    - 「CSV ファイルを選択」ボタンを配置。
    - 選択されたファイル名を表示。ファイル選択は任意であり、必須ではないことを明記。
  - **「完了」ボタン**: このボタンを押すと、セッション情報と、選択されていればイベント CSV が`Session Manager Service`に送信される。

---

## 4. UI/UX フロー

### セッション開始フロー

1.  **実験選択**:
    - ユーザーはホーム画面の「変更」ボタンか、ハンバーガーメニューから「実験一覧」画面へ遷移。
    - 参加したい実験をリストからタップして選択する。（または新規作成する）
2.  **ホーム画面**:
    - ホーム画面に戻ると、選択した実験名が表示されていることを確認。
    - BLE デバイスに接続する。
3.  **セッションタイプ選択**:
    - 「セッション開始」ボタンをタップ。
    - **「セッション種別を選択」というダイアログが表示される。**
    - 「キャリブレーション」と「本計測」の 2 つのボタンを明確に表示。ユーザーはいずれかを選択する。
      - （オプション）「キャリブレーション」選択時、どの「本計測」のためのものか紐付けるための入力欄を表示しても良い。
4.  **計測開始**:
    - セッションが開始され、ホーム画面のボタンが「セッション終了」（赤色）に変わる。
    - アプリは生データとメディアファイル（音声・画像）のサーバーへのアップロードを開始する。

### セッション終了フロー

1.  **計測終了**:
    - ユーザーが「セッション終了」ボタンをタップ。
    - アプリはセッション終了時刻を記録し、セッション終了画面に遷移する。
2.  **最終処理**:
    - ユーザーは必要に応じてイベント CSV ファイルを選択する。
    - 「完了」ボタンをタップ。
3.  **完了**:
    - アプリはセッション情報を`Session Manager`に送信し、ホーム画面に戻る。
