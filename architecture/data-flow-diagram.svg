<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="5365pt" height="5175pt"
 viewBox="0.00 0.00 5364.62 5175.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 5171)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-5171 5360.62,-5171 5360.62,4 -4,4"/>
<text text-anchor="middle" x="2678.31" y="-5147" font-family="Times,serif" font-size="20.00">Interactive Data Flow Diagram</text>
<!-- Smartphone_App -->
<g id="node1" class="node">
<title>Smartphone_App</title>
<g id="a_node1"><a xlink:title="ユーザーインターフェースを提供し、ファームウェアとサーバー群を繋ぐ中継ハブ。実験設計、セッション管理、データ中継の役割を担う。">
<path fill="#ffffff" stroke="black" d="M636.89,-2899C636.89,-2899 553.89,-2899 553.89,-2899 547.89,-2899 541.89,-2893 541.89,-2887 541.89,-2887 541.89,-2875 541.89,-2875 541.89,-2869 547.89,-2863 553.89,-2863 553.89,-2863 636.89,-2863 636.89,-2863 642.89,-2863 648.89,-2869 648.89,-2875 648.89,-2875 648.89,-2887 648.89,-2887 648.89,-2893 642.89,-2899 636.89,-2899"/>
<text text-anchor="middle" x="595.39" y="-2877.9" font-family="Arial" font-size="12.00">Smartphone App</text>
</a>
</g>
</g>
<!-- Collector -->
<g id="node5" class="node">
<title>Collector</title>
<g id="a_node5"><a xlink:title="Collectorサービス">
<path fill="#ffffff" stroke="black" d="M1037.39,-2899C1037.39,-2899 948.39,-2899 948.39,-2899 942.39,-2899 936.39,-2893 936.39,-2887 936.39,-2887 936.39,-2875 936.39,-2875 936.39,-2869 942.39,-2863 948.39,-2863 948.39,-2863 1037.39,-2863 1037.39,-2863 1043.39,-2863 1049.39,-2869 1049.39,-2875 1049.39,-2875 1049.39,-2887 1049.39,-2887 1049.39,-2893 1043.39,-2899 1037.39,-2899"/>
<text text-anchor="middle" x="992.89" y="-2877.9" font-family="Arial" font-size="12.00">Collectorサービス</text>
</a>
</g>
</g>
<!-- Smartphone_App&#45;&gt;Collector -->
<g id="edge4" class="edge">
<title>Smartphone_App&#45;&gt;Collector</title>
<g id="a_edge4"><a xlink:title="エンドポイント `/api/v1/data`: { user_id, payload_base64 }">
<path fill="none" stroke="black" d="M648.99,-2881C648.99,-2881 926.28,-2881 926.28,-2881"/>
<polygon fill="black" stroke="black" points="926.28,-2884.5 936.28,-2881 926.28,-2877.5 926.28,-2884.5"/>
</a>
</g>
<text text-anchor="middle" x="915.14" y="-2873" font-family="Arial" font-size="10.00">HTTP POST (JSON)</text>
<text text-anchor="middle" x="915.14" y="-2862" font-family="Arial" font-size="10.00">エンドポイント `/api/v1/data`: { user_id, payload_base64 }</text>
</g>
<!-- Smartphone_App&#45;&gt;Collector -->
<g id="edge5" class="edge">
<title>Smartphone_App&#45;&gt;Collector</title>
<g id="a_edge5"><a xlink:title="エンドポイント `/api/v1/media`: { user_id, session_id } を含むメディアファイル">
<path fill="none" stroke="black" d="M648.99,-2890C648.99,-2890 926.28,-2890 926.28,-2890"/>
<polygon fill="black" stroke="black" points="926.28,-2893.5 936.28,-2890 926.28,-2886.5 926.28,-2893.5"/>
</a>
</g>
<text text-anchor="middle" x="613.14" y="-2904" font-family="Arial" font-size="10.00">HTTP POST (Multipart/form&#45;data)</text>
<text text-anchor="middle" x="613.14" y="-2893" font-family="Arial" font-size="10.00">エンドポイント `/api/v1/media`: { user_id, session_id } を含むメディアファイル</text>
</g>
<!-- Session_Manager -->
<g id="node6" class="node">
<title>Session_Manager</title>
<g id="a_node6"><a xlink:title="Session Managerサービス">
<path fill="#ffffff" stroke="black" d="M1059.89,-2755C1059.89,-2755 925.89,-2755 925.89,-2755 919.89,-2755 913.89,-2749 913.89,-2743 913.89,-2743 913.89,-2731 913.89,-2731 913.89,-2725 919.89,-2719 925.89,-2719 925.89,-2719 1059.89,-2719 1059.89,-2719 1065.89,-2719 1071.89,-2725 1071.89,-2731 1071.89,-2731 1071.89,-2743 1071.89,-2743 1071.89,-2749 1065.89,-2755 1059.89,-2755"/>
<text text-anchor="middle" x="992.89" y="-2733.9" font-family="Arial" font-size="12.00">Session Managerサービス</text>
</a>
</g>
</g>
<!-- Smartphone_App&#45;&gt;Session_Manager -->
<g id="edge6" class="edge">
<title>Smartphone_App&#45;&gt;Session_Manager</title>
<g id="a_edge6"><a xlink:title="実験作成リクエスト、刺激アセット登録、セッション終了通知">
<path fill="none" stroke="black" d="M649.13,-2872C743.68,-2872 929.89,-2872 929.89,-2872 929.89,-2872 929.89,-2765.21 929.89,-2765.21"/>
<polygon fill="black" stroke="black" points="933.39,-2765.21 929.89,-2755.21 926.39,-2765.21 933.39,-2765.21"/>
</a>
</g>
<text text-anchor="middle" x="705.9" y="-2864" font-family="Arial" font-size="10.00">HTTP POST/GET (JSON), HTTP POST (Multipart/form&#45;data)</text>
<text text-anchor="middle" x="705.9" y="-2853" font-family="Arial" font-size="10.00">実験作成リクエスト、刺激アセット登録、セッション終了通知</text>
</g>
<!-- BLE -->
<g id="node2" class="node">
<title>BLE</title>
<g id="a_node2"><a xlink:title="ファームウェア (BLE)">
<path fill="#ffffff" stroke="black" d="M230.89,-3043C230.89,-3043 120.89,-3043 120.89,-3043 114.89,-3043 108.89,-3037 108.89,-3031 108.89,-3031 108.89,-3019 108.89,-3019 108.89,-3013 114.89,-3007 120.89,-3007 120.89,-3007 230.89,-3007 230.89,-3007 236.89,-3007 242.89,-3013 242.89,-3019 242.89,-3019 242.89,-3031 242.89,-3031 242.89,-3037 236.89,-3043 230.89,-3043"/>
<text text-anchor="middle" x="175.89" y="-3021.9" font-family="Arial" font-size="12.00">ファームウェア (BLE)</text>
</a>
</g>
</g>
<!-- BLE&#45;&gt;Smartphone_App -->
<g id="edge1" class="edge">
<title>BLE&#45;&gt;Smartphone_App</title>
<g id="a_edge1"><a xlink:title="Zstandard圧縮されたバイナリデータ">
<path fill="none" stroke="black" d="M228.89,-3006.79C228.89,-2969.94 228.89,-2890 228.89,-2890 228.89,-2890 531.7,-2890 531.7,-2890"/>
<polygon fill="black" stroke="black" points="531.7,-2893.5 541.7,-2890 531.7,-2886.5 531.7,-2893.5"/>
</a>
</g>
<text text-anchor="middle" x="407.4" y="-2882" font-family="Arial" font-size="10.00">BLE Notify (Compressed Sensor Data)</text>
<text text-anchor="middle" x="407.4" y="-2871" font-family="Arial" font-size="10.00">Zstandard圧縮されたバイナリデータ</text>
</g>
<!-- node -->
<g id="node3" class="node">
<title>node</title>
<g id="a_node3"><a xlink:title="ユーザー">
<path fill="#ffffff" stroke="black" d="M196.39,-2899C196.39,-2899 155.39,-2899 155.39,-2899 149.39,-2899 143.39,-2893 143.39,-2887 143.39,-2887 143.39,-2875 143.39,-2875 143.39,-2869 149.39,-2863 155.39,-2863 155.39,-2863 196.39,-2863 196.39,-2863 202.39,-2863 208.39,-2869 208.39,-2875 208.39,-2875 208.39,-2887 208.39,-2887 208.39,-2893 202.39,-2899 196.39,-2899"/>
<text text-anchor="middle" x="175.89" y="-2877.9" font-family="Arial" font-size="12.00">ユーザー</text>
</a>
</g>
</g>
<!-- node&#45;&gt;Smartphone_App -->
<g id="edge2" class="edge">
<title>node&#45;&gt;Smartphone_App</title>
<g id="a_edge2"><a xlink:title="ログイン、実験の作成/選択/設計、セッションモード選択、セッション開始/終了など">
<path fill="none" stroke="black" d="M208.45,-2881C208.45,-2881 531.55,-2881 531.55,-2881"/>
<polygon fill="black" stroke="black" points="531.55,-2884.5 541.55,-2881 531.55,-2877.5 531.55,-2884.5"/>
</a>
</g>
<text text-anchor="middle" x="185" y="-2873" font-family="Arial" font-size="10.00">UI操作</text>
<text text-anchor="middle" x="185" y="-2862" font-family="Arial" font-size="10.00">ログイン、実験の作成/選択/設計、セッションモード選択、セッション開始/終了など</text>
</g>
<!-- node_2 -->
<g id="node4" class="node">
<title>node_2</title>
<g id="a_node4"><a xlink:title="内蔵マイク・カメラ">
<path fill="#ffffff" stroke="black" d="M226.39,-2755C226.39,-2755 125.39,-2755 125.39,-2755 119.39,-2755 113.39,-2749 113.39,-2743 113.39,-2743 113.39,-2731 113.39,-2731 113.39,-2725 119.39,-2719 125.39,-2719 125.39,-2719 226.39,-2719 226.39,-2719 232.39,-2719 238.39,-2725 238.39,-2731 238.39,-2731 238.39,-2743 238.39,-2743 238.39,-2749 232.39,-2755 226.39,-2755"/>
<text text-anchor="middle" x="175.89" y="-2733.9" font-family="Arial" font-size="12.00">内蔵マイク・カメラ</text>
</a>
</g>
</g>
<!-- node_2&#45;&gt;Smartphone_App -->
<g id="edge3" class="edge">
<title>node_2&#45;&gt;Smartphone_App</title>
<g id="a_edge3"><a xlink:title="セッション中に定期的にキャプチャされるメディアデータ">
<path fill="none" stroke="black" d="M218.89,-2755.21C218.89,-2792.06 218.89,-2872 218.89,-2872 218.89,-2872 531.84,-2872 531.84,-2872"/>
<polygon fill="black" stroke="black" points="531.84,-2875.5 541.84,-2872 531.84,-2868.5 531.84,-2875.5"/>
</a>
</g>
<text text-anchor="middle" x="443.97" y="-2864" font-family="Arial" font-size="10.00">音声(WAVなど), 画像(JPEGなど)</text>
<text text-anchor="middle" x="443.97" y="-2853" font-family="Arial" font-size="10.00">セッション中に定期的にキャプチャされるメディアデータ</text>
</g>
<!-- Auth_Manager_Service -->
<g id="node7" class="node">
<title>Auth_Manager_Service</title>
<g id="a_node7"><a xlink:title="実験への参加権限とロールを統合管理し、他サービスからの認可問い合わせに対して判定結果を返す。">
<path fill="#e8f0fe" stroke="black" d="M650.89,-3382C650.89,-3382 539.89,-3382 539.89,-3382 533.89,-3382 527.89,-3376 527.89,-3370 527.89,-3370 527.89,-3358 527.89,-3358 527.89,-3352 533.89,-3346 539.89,-3346 539.89,-3346 650.89,-3346 650.89,-3346 656.89,-3346 662.89,-3352 662.89,-3358 662.89,-3358 662.89,-3370 662.89,-3370 662.89,-3376 656.89,-3382 650.89,-3382"/>
<text text-anchor="middle" x="595.39" y="-3360.9" font-family="Arial" font-size="12.00">Auth Manager Service</text>
</a>
</g>
</g>
<!-- Session_Manager_Service -->
<g id="node9" class="node">
<title>Session_Manager_Service</title>
<g id="a_node9"><a xlink:title="Session Manager Service">
<path fill="#ffffff" stroke="black" d="M1057.89,-3382C1057.89,-3382 927.89,-3382 927.89,-3382 921.89,-3382 915.89,-3376 915.89,-3370 915.89,-3370 915.89,-3358 915.89,-3358 915.89,-3352 921.89,-3346 927.89,-3346 927.89,-3346 1057.89,-3346 1057.89,-3346 1063.89,-3346 1069.89,-3352 1069.89,-3358 1069.89,-3358 1069.89,-3370 1069.89,-3370 1069.89,-3376 1063.89,-3382 1057.89,-3382"/>
<text text-anchor="middle" x="992.89" y="-3360.9" font-family="Arial" font-size="12.00">Session Manager Service</text>
</a>
</g>
</g>
<!-- Auth_Manager_Service&#45;&gt;Session_Manager_Service -->
<g id="edge81" class="edge">
<title>Auth_Manager_Service&#45;&gt;Session_Manager_Service</title>
<g id="a_edge81"><a xlink:title="POST /api/v1/auth/check&#10;Body: { user_id: string, experiment_id: uuid, required_role: &#39;owner&#39;|&#39;participant&#39; }&#10;用途: requireAuth ミドルウェアによるロール検証&#10;">
<path fill="none" stroke="black" d="M663.27,-3367.6C663.27,-3367.6 905.76,-3367.6 905.76,-3367.6"/>
<polygon fill="black" stroke="black" points="905.76,-3371.1 915.76,-3367.6 905.76,-3364.1 905.76,-3371.1"/>
</a>
</g>
<text text-anchor="middle" x="613.01" y="-3403.6" font-family="Arial" font-size="10.00">HTTP POST (JSON)</text>
<text text-anchor="middle" x="613.01" y="-3392.6" font-family="Arial" font-size="10.00">POST /api/v1/auth/check</text>
<text text-anchor="middle" x="613.01" y="-3381.6" font-family="Arial" font-size="10.00">Body: { user_id: string, experiment_id: uuid, required_role: &#39;owner&#39;|&#39;participant&#39; }</text>
<text text-anchor="middle" x="613.01" y="-3370.6" font-family="Arial" font-size="10.00">用途: requireAuth ミドルウェアによるロール検証</text>
</g>
<!-- PostgreSQL -->
<g id="node10" class="node">
<title>PostgreSQL</title>
<g id="a_node10"><a xlink:title="PostgreSQL">
<path fill="#ffffff" stroke="black" d="M1421.89,-3042C1421.89,-3042 1363.89,-3042 1363.89,-3042 1357.89,-3042 1351.89,-3036 1351.89,-3030 1351.89,-3030 1351.89,-3018 1351.89,-3018 1351.89,-3012 1357.89,-3006 1363.89,-3006 1363.89,-3006 1421.89,-3006 1421.89,-3006 1427.89,-3006 1433.89,-3012 1433.89,-3018 1433.89,-3018 1433.89,-3030 1433.89,-3030 1433.89,-3036 1427.89,-3042 1421.89,-3042"/>
<text text-anchor="middle" x="1392.89" y="-3020.9" font-family="Arial" font-size="12.00">PostgreSQL</text>
</a>
</g>
</g>
<!-- Auth_Manager_Service&#45;&gt;PostgreSQL -->
<g id="edge10" class="edge">
<title>Auth_Manager_Service&#45;&gt;PostgreSQL</title>
<g id="a_edge10"><a xlink:title="&#45; INSERT experiment_participants(experiment_id, user_id, role)&#10;&#45; UPDATE experiment_participants SET role = $1 WHERE experiment_id = $2 AND user_id = $3&#10;">
<path fill="none" stroke="black" d="M663.35,-3353.2C712.35,-3353.2 769.89,-3353.2 769.89,-3353.2 769.89,-3353.2 769.89,-3014 769.89,-3014 769.89,-3014 1341.53,-3014 1341.53,-3014"/>
<polygon fill="black" stroke="black" points="1341.53,-3017.5 1351.53,-3014 1341.53,-3010.5 1341.53,-3017.5"/>
</a>
</g>
<text text-anchor="middle" x="619.84" y="-3006" font-family="Arial" font-size="10.00">SQL INSERT/UPDATE</text>
<text text-anchor="middle" x="619.84" y="-2995" font-family="Arial" font-size="10.00">&#45; INSERT experiment_participants(experiment_id, user_id, role)</text>
<text text-anchor="middle" x="619.84" y="-2984" font-family="Arial" font-size="10.00">&#45; UPDATE experiment_participants SET role = $1 WHERE experiment_id = $2 AND user_id = $3</text>
</g>
<!-- node_3 -->
<g id="node11" class="node">
<title>node_3</title>
<g id="a_node11"><a xlink:title="呼び出し元クライアント">
<path fill="#ffffff" stroke="black" d="M1055.39,-5137C1055.39,-5137 930.39,-5137 930.39,-5137 924.39,-5137 918.39,-5131 918.39,-5125 918.39,-5125 918.39,-5113 918.39,-5113 918.39,-5107 924.39,-5101 930.39,-5101 930.39,-5101 1055.39,-5101 1055.39,-5101 1061.39,-5101 1067.39,-5107 1067.39,-5113 1067.39,-5113 1067.39,-5125 1067.39,-5125 1067.39,-5131 1061.39,-5137 1055.39,-5137"/>
<text text-anchor="middle" x="992.89" y="-5115.9" font-family="Arial" font-size="12.00">呼び出し元クライアント</text>
</a>
</g>
</g>
<!-- Auth_Manager_Service&#45;&gt;node_3 -->
<g id="edge11" class="edge">
<title>Auth_Manager_Service&#45;&gt;node_3</title>
<g id="a_edge11"><a xlink:title="成功レスポンス:&#10; &#160;&#45; 参加登録: {&quot;message&quot;: &quot;Successfully joined experiment&quot;}&#10; &#160;&#45; 参加者一覧: [{&quot;user_id&quot;,&quot;role&quot;,&quot;joined_at&quot;}]&#10; &#160;&#45; 権限判定: {&quot;authorized&quot;: boolean}&#10;エラーレスポンス: {&quot;error&quot;: string}">
<path fill="none" stroke="black" d="M572.89,-3382.23C572.89,-3568.48 572.89,-5119 572.89,-5119 572.89,-5119 908.28,-5119 908.28,-5119"/>
<polygon fill="black" stroke="black" points="908.28,-5122.5 918.28,-5119 908.28,-5115.5 908.28,-5122.5"/>
</a>
</g>
<text text-anchor="middle" x="442.89" y="-4410.31" font-family="Arial" font-size="10.00">HTTP JSON</text>
<text text-anchor="middle" x="442.89" y="-4399.31" font-family="Arial" font-size="10.00">成功レスポンス:</text>
<text text-anchor="middle" x="442.89" y="-4388.31" font-family="Arial" font-size="10.00"> &#160;&#45; 参加登録: {&quot;message&quot;: &quot;Successfully joined experiment&quot;}</text>
<text text-anchor="middle" x="442.89" y="-4377.31" font-family="Arial" font-size="10.00"> &#160;&#45; 参加者一覧: [{&quot;user_id&quot;,&quot;role&quot;,&quot;joined_at&quot;}]</text>
<text text-anchor="middle" x="442.89" y="-4366.31" font-family="Arial" font-size="10.00"> &#160;&#45; 権限判定: {&quot;authorized&quot;: boolean}</text>
<text text-anchor="middle" x="442.89" y="-4355.31" font-family="Arial" font-size="10.00">エラーレスポンス: {&quot;error&quot;: string}</text>
</g>
<!-- ERP_Neuro_Marketing_Service -->
<g id="node14" class="node">
<title>ERP_Neuro_Marketing_Service</title>
<g id="a_node14"><a xlink:title="ERP Neuro&#45;Marketing Service">
<path fill="#ffffff" stroke="black" d="M4909.89,-4466C4909.89,-4466 4756.89,-4466 4756.89,-4466 4750.89,-4466 4744.89,-4460 4744.89,-4454 4744.89,-4454 4744.89,-4442 4744.89,-4442 4744.89,-4436 4750.89,-4430 4756.89,-4430 4756.89,-4430 4909.89,-4430 4909.89,-4430 4915.89,-4430 4921.89,-4436 4921.89,-4442 4921.89,-4442 4921.89,-4454 4921.89,-4454 4921.89,-4460 4915.89,-4466 4909.89,-4466"/>
<text text-anchor="middle" x="4833.39" y="-4444.9" font-family="Arial" font-size="12.00">ERP Neuro&#45;Marketing Service</text>
</a>
</g>
</g>
<!-- Auth_Manager_Service&#45;&gt;ERP_Neuro_Marketing_Service -->
<g id="edge32" class="edge">
<title>Auth_Manager_Service&#45;&gt;ERP_Neuro_Marketing_Service</title>
<g id="a_edge32"><a xlink:title="POST {AUTH_MANAGER_URL}/api/v1/auth/check&#10;Body: { user_id: string, experiment_id: uuid, required_role: &#39;owner&#39; }&#10;用途: verify_owner_role 依存性での権限チェック&#10;">
<path fill="none" stroke="black" d="M617.89,-3382.26C617.89,-3523.92 617.89,-4442 617.89,-4442 617.89,-4442 4734.85,-4442 4734.85,-4442"/>
<polygon fill="black" stroke="black" points="4734.85,-4445.5 4744.85,-4442 4734.85,-4438.5 4734.85,-4445.5"/>
</a>
</g>
<text text-anchor="middle" x="2000.5" y="-4434" font-family="Arial" font-size="10.00">HTTP POST (JSON)</text>
<text text-anchor="middle" x="2000.5" y="-4423" font-family="Arial" font-size="10.00">POST {AUTH_MANAGER_URL}/api/v1/auth/check</text>
<text text-anchor="middle" x="2000.5" y="-4412" font-family="Arial" font-size="10.00">Body: { user_id: string, experiment_id: uuid, required_role: &#39;owner&#39; }</text>
<text text-anchor="middle" x="2000.5" y="-4401" font-family="Arial" font-size="10.00">用途: verify_owner_role 依存性での権限チェック</text>
</g>
<!-- Frontend_HTTP -->
<g id="node8" class="node">
<title>Frontend_HTTP</title>
<g id="a_node8"><a xlink:title="Frontend / 内部HTTPクライアント">
<path fill="#ffffff" stroke="black" d="M264.89,-3382C264.89,-3382 86.89,-3382 86.89,-3382 80.89,-3382 74.89,-3376 74.89,-3370 74.89,-3370 74.89,-3358 74.89,-3358 74.89,-3352 80.89,-3346 86.89,-3346 86.89,-3346 264.89,-3346 264.89,-3346 270.89,-3346 276.89,-3352 276.89,-3358 276.89,-3358 276.89,-3370 276.89,-3370 276.89,-3376 270.89,-3382 264.89,-3382"/>
<text text-anchor="middle" x="175.89" y="-3360.9" font-family="Arial" font-size="12.00">Frontend / 内部HTTPクライアント</text>
</a>
</g>
</g>
<!-- Frontend_HTTP&#45;&gt;Auth_Manager_Service -->
<g id="edge7" class="edge">
<title>Frontend_HTTP&#45;&gt;Auth_Manager_Service</title>
<g id="a_edge7"><a xlink:title="POST /api/v1/auth/experiments/:experiment_id/join&#10;Body:&#10; &#160;user_id: string&#10; &#160;password?: string&#10;">
<path fill="none" stroke="black" d="M276.9,-3364C276.9,-3364 517.66,-3364 517.66,-3364"/>
<polygon fill="black" stroke="black" points="517.66,-3367.5 527.66,-3364 517.66,-3360.5 517.66,-3367.5"/>
</a>
</g>
<text text-anchor="middle" x="508.78" y="-3356" font-family="Arial" font-size="10.00">HTTP POST (JSON)</text>
<text text-anchor="middle" x="508.78" y="-3345" font-family="Arial" font-size="10.00">POST /api/v1/auth/experiments/:experiment_id/join</text>
<text text-anchor="middle" x="508.78" y="-3334" font-family="Arial" font-size="10.00">Body:</text>
<text text-anchor="middle" x="508.78" y="-3323" font-family="Arial" font-size="10.00"> &#160;user_id: string</text>
<text text-anchor="middle" x="508.78" y="-3312" font-family="Arial" font-size="10.00"> &#160;password?: string</text>
</g>
<!-- Session_Manager_Service&#45;&gt;Auth_Manager_Service -->
<g id="edge8" class="edge">
<title>Session_Manager_Service&#45;&gt;Auth_Manager_Service</title>
<g id="a_edge8"><a xlink:title="POST /api/v1/auth/check&#10;Body:&#10; &#160;user_id: string&#10; &#160;experiment_id: uuid&#10; &#160;required_role: &#39;owner&#39; | &#39;participant&#39;&#10;">
<path fill="none" stroke="black" d="M915.77,-3374.8C915.77,-3374.8 673.02,-3374.8 673.02,-3374.8"/>
<polygon fill="black" stroke="black" points="673.02,-3371.3 663.02,-3374.8 673.02,-3378.3 673.02,-3371.3"/>
</a>
</g>
<text text-anchor="middle" x="872.89" y="-3432.8" font-family="Arial" font-size="10.00">HTTP POST (JSON)</text>
<text text-anchor="middle" x="872.89" y="-3421.8" font-family="Arial" font-size="10.00">POST /api/v1/auth/check</text>
<text text-anchor="middle" x="872.89" y="-3410.8" font-family="Arial" font-size="10.00">Body:</text>
<text text-anchor="middle" x="872.89" y="-3399.8" font-family="Arial" font-size="10.00"> &#160;user_id: string</text>
<text text-anchor="middle" x="872.89" y="-3388.8" font-family="Arial" font-size="10.00"> &#160;experiment_id: uuid</text>
<text text-anchor="middle" x="872.89" y="-3377.8" font-family="Arial" font-size="10.00"> &#160;required_role: &#39;owner&#39; | &#39;participant&#39;</text>
</g>
<!-- Session_Manager_Service&#45;&gt;PostgreSQL -->
<g id="edge84" class="edge">
<title>Session_Manager_Service&#45;&gt;PostgreSQL</title>
<g id="a_edge84"><a xlink:title="&#45; INSERT experiments, experiment_participants&#10;&#45; INSERT sessions, UPDATE sessions(end_time, device_id, link_status)&#10;&#45; INSERT session_events (CSV 取込時は該当セッションの既存レコードを DELETE 後に一括 INSERT)&#10;">
<path fill="none" stroke="black" d="M1058.89,-3345.94C1058.89,-3276.14 1058.89,-3028 1058.89,-3028 1058.89,-3028 1341.6,-3028 1341.6,-3028"/>
<polygon fill="black" stroke="black" points="1341.6,-3031.5 1351.6,-3028 1341.6,-3024.5 1341.6,-3031.5"/>
</a>
</g>
<text text-anchor="middle" x="830.39" y="-3081.61" font-family="Arial" font-size="10.00">SQL INSERT/UPDATE/DELETE</text>
<text text-anchor="middle" x="830.39" y="-3070.61" font-family="Arial" font-size="10.00">&#45; INSERT experiments, experiment_participants</text>
<text text-anchor="middle" x="830.39" y="-3059.61" font-family="Arial" font-size="10.00">&#45; INSERT sessions, UPDATE sessions(end_time, device_id, link_status)</text>
<text text-anchor="middle" x="830.39" y="-3048.61" font-family="Arial" font-size="10.00">&#45; INSERT session_events (CSV 取込時は該当セッションの既存レコードを DELETE 後に一括 INSERT)</text>
</g>
<!-- BIDS_Exporter_Service -->
<g id="node12" class="node">
<title>BIDS_Exporter_Service</title>
<g id="a_node12"><a xlink:title="完了済みセッションと刺激アセットを集約し、BIDS 形式データセットを生成して MinIO へ保存する FastAPI サービス。">
<path fill="#e8f0fe" stroke="black" d="M4475.89,-4013C4475.89,-4013 4362.89,-4013 4362.89,-4013 4356.89,-4013 4350.89,-4007 4350.89,-4001 4350.89,-4001 4350.89,-3989 4350.89,-3989 4350.89,-3983 4356.89,-3977 4362.89,-3977 4362.89,-3977 4475.89,-3977 4475.89,-3977 4481.89,-3977 4487.89,-3983 4487.89,-3989 4487.89,-3989 4487.89,-4001 4487.89,-4001 4487.89,-4007 4481.89,-4013 4475.89,-4013"/>
<text text-anchor="middle" x="4419.39" y="-3991.9" font-family="Arial" font-size="12.00">BIDS Exporter Service</text>
</a>
</g>
</g>
<!-- Session_Manager_Service&#45;&gt;BIDS_Exporter_Service -->
<g id="edge87" class="edge">
<title>Session_Manager_Service&#45;&gt;BIDS_Exporter_Service</title>
<g id="a_edge87"><a xlink:title="POST /api/v1/experiments/:experiment_id/export (ヘッダー X&#45;User&#45;Id を透過)&#10;">
<path fill="none" stroke="black" d="M1070.13,-3365.5C1575.18,-3365.5 4385.89,-3365.5 4385.89,-3365.5 4385.89,-3365.5 4385.89,-3966.84 4385.89,-3966.84"/>
<polygon fill="black" stroke="black" points="4382.39,-3966.84 4385.89,-3976.84 4389.39,-3966.84 4382.39,-3966.84"/>
</a>
</g>
<text text-anchor="middle" x="2859.68" y="-3357.5" font-family="Arial" font-size="10.00">HTTP POST</text>
<text text-anchor="middle" x="2859.68" y="-3346.5" font-family="Arial" font-size="10.00">POST /api/v1/experiments/:experiment_id/export (ヘッダー X&#45;User&#45;Id を透過)</text>
</g>
<!-- PostgreSQL_Database -->
<g id="node36" class="node">
<title>PostgreSQL_Database</title>
<g id="a_node36"><a xlink:title="実験・セッション・刺激・解析結果など構造化メタデータを保持する永続ストア。全サービスの一貫性を担保する。">
<path fill="#f8d7da" stroke="black" d="M4889.39,-2763C4889.39,-2763 4777.39,-2763 4777.39,-2763 4771.39,-2763 4765.39,-2757 4765.39,-2751 4765.39,-2751 4765.39,-2739 4765.39,-2739 4765.39,-2733 4771.39,-2727 4777.39,-2727 4777.39,-2727 4889.39,-2727 4889.39,-2727 4895.39,-2727 4901.39,-2733 4901.39,-2739 4901.39,-2739 4901.39,-2751 4901.39,-2751 4901.39,-2757 4895.39,-2763 4889.39,-2763"/>
<text text-anchor="middle" x="4833.39" y="-2741.9" font-family="Arial" font-size="12.00">PostgreSQL Database</text>
</a>
</g>
</g>
<!-- Session_Manager_Service&#45;&gt;PostgreSQL_Database -->
<g id="edge55" class="edge">
<title>Session_Manager_Service&#45;&gt;PostgreSQL_Database</title>
<g id="a_edge55"><a xlink:title="&#45; experiments, experiment_participants&#10;&#45; sessions, session_events, experiment_stimuli, calibration_items&#10;">
<path fill="none" stroke="black" d="M1052.89,-3345.85C1052.89,-3244.97 1052.89,-2757.67 1052.89,-2757.67 1052.89,-2757.67 4755.35,-2757.67 4755.35,-2757.67"/>
<polygon fill="black" stroke="black" points="4755.35,-2761.17 4765.35,-2757.67 4755.35,-2754.17 4755.35,-2761.17"/>
</a>
</g>
<text text-anchor="middle" x="2466.53" y="-2749.67" font-family="Arial" font-size="10.00">SQL INSERT/UPDATE/SELECT</text>
<text text-anchor="middle" x="2466.53" y="-2738.67" font-family="Arial" font-size="10.00">&#45; experiments, experiment_participants</text>
<text text-anchor="middle" x="2466.53" y="-2727.67" font-family="Arial" font-size="10.00">&#45; sessions, session_events, experiment_stimuli, calibration_items</text>
</g>
<!-- RabbitMQ -->
<g id="node38" class="node">
<title>RabbitMQ</title>
<g id="a_node38"><a xlink:title="Collector からのストリームデータとサービス間ジョブを仲介するメッセージブローカー。fanout exchange と複数キューで構成される。">
<path fill="#fff3cd" stroke="black" d="M2191.39,-1038C2191.39,-1038 2144.39,-1038 2144.39,-1038 2138.39,-1038 2132.39,-1032 2132.39,-1026 2132.39,-1026 2132.39,-1014 2132.39,-1014 2132.39,-1008 2138.39,-1002 2144.39,-1002 2144.39,-1002 2191.39,-1002 2191.39,-1002 2197.39,-1002 2203.39,-1008 2203.39,-1014 2203.39,-1014 2203.39,-1026 2203.39,-1026 2203.39,-1032 2197.39,-1038 2191.39,-1038"/>
<text text-anchor="middle" x="2167.89" y="-1016.9" font-family="Arial" font-size="12.00">RabbitMQ</text>
</a>
</g>
</g>
<!-- Session_Manager_Service&#45;&gt;RabbitMQ -->
<g id="edge68" class="edge">
<title>Session_Manager_Service&#45;&gt;RabbitMQ</title>
<g id="a_edge68"><a xlink:title="&#45; Queue: stimulus_asset_queue &#45;&gt; { experiment_id, csvDefinition[], files[] }&#10;&#45; Queue: data_linker_queue &#45;&gt; { session_id }&#10;">
<path fill="none" stroke="black" d="M1069.98,-3359C1331.39,-3359 2167.89,-3359 2167.89,-3359 2167.89,-3359 2167.89,-1048.15 2167.89,-1048.15"/>
<polygon fill="black" stroke="black" points="2171.39,-1048.15 2167.89,-1038.15 2164.39,-1048.15 2171.39,-1048.15"/>
</a>
</g>
<text text-anchor="middle" x="2005.39" y="-2744.53" font-family="Arial" font-size="10.00">AMQP sendToQueue</text>
<text text-anchor="middle" x="2005.39" y="-2733.53" font-family="Arial" font-size="10.00">&#45; Queue: stimulus_asset_queue &#45;&gt; { experiment_id, csvDefinition[], files[] }</text>
<text text-anchor="middle" x="2005.39" y="-2722.53" font-family="Arial" font-size="10.00">&#45; Queue: data_linker_queue &#45;&gt; { session_id }</text>
</g>
<!-- RabbitMQ_stimulus_asset_queue -->
<g id="node42" class="node">
<title>RabbitMQ_stimulus_asset_queue</title>
<g id="a_node42"><a xlink:title="RabbitMQ (stimulus_asset_queue)">
<path fill="#ffffff" stroke="black" d="M1481.39,-3408C1481.39,-3408 1304.39,-3408 1304.39,-3408 1298.39,-3408 1292.39,-3402 1292.39,-3396 1292.39,-3396 1292.39,-3384 1292.39,-3384 1292.39,-3378 1298.39,-3372 1304.39,-3372 1304.39,-3372 1481.39,-3372 1481.39,-3372 1487.39,-3372 1493.39,-3378 1493.39,-3384 1493.39,-3384 1493.39,-3396 1493.39,-3396 1493.39,-3402 1487.39,-3408 1481.39,-3408"/>
<text text-anchor="middle" x="1392.89" y="-3386.9" font-family="Arial" font-size="12.00">RabbitMQ (stimulus_asset_queue)</text>
</a>
</g>
</g>
<!-- Session_Manager_Service&#45;&gt;RabbitMQ_stimulus_asset_queue -->
<g id="edge85" class="edge">
<title>Session_Manager_Service&#45;&gt;RabbitMQ_stimulus_asset_queue</title>
<g id="a_edge85"><a xlink:title="{ experiment_id: uuid, csvDefinition: [{trial_type,file_name,description?}], files: [{fileName,mimeType,contentBase64}] }&#10;">
<path fill="none" stroke="black" d="M1070.01,-3377C1070.01,-3377 1282.13,-3377 1282.13,-3377"/>
<polygon fill="black" stroke="black" points="1282.13,-3380.5 1292.13,-3377 1282.13,-3373.5 1282.13,-3380.5"/>
</a>
</g>
<text text-anchor="middle" x="1434.07" y="-3369" font-family="Arial" font-size="10.00">AMQP message (JSON)</text>
<text text-anchor="middle" x="1434.07" y="-3358" font-family="Arial" font-size="10.00">{ experiment_id: uuid, csvDefinition: [{trial_type,file_name,description?}], files: [{fileName,mimeType,contentBase64}] }</text>
</g>
<!-- RabbitMQ_data_linker_queue -->
<g id="node43" class="node">
<title>RabbitMQ_data_linker_queue</title>
<g id="a_node43"><a xlink:title="RabbitMQ (data_linker_queue)">
<path fill="#ffffff" stroke="black" d="M1471.39,-3264C1471.39,-3264 1314.39,-3264 1314.39,-3264 1308.39,-3264 1302.39,-3258 1302.39,-3252 1302.39,-3252 1302.39,-3240 1302.39,-3240 1302.39,-3234 1308.39,-3228 1314.39,-3228 1314.39,-3228 1471.39,-3228 1471.39,-3228 1477.39,-3228 1483.39,-3234 1483.39,-3240 1483.39,-3240 1483.39,-3252 1483.39,-3252 1483.39,-3258 1477.39,-3264 1471.39,-3264"/>
<text text-anchor="middle" x="1392.89" y="-3242.9" font-family="Arial" font-size="12.00">RabbitMQ (data_linker_queue)</text>
</a>
</g>
</g>
<!-- Session_Manager_Service&#45;&gt;RabbitMQ_data_linker_queue -->
<g id="edge86" class="edge">
<title>Session_Manager_Service&#45;&gt;RabbitMQ_data_linker_queue</title>
<g id="a_edge86"><a xlink:title="{ session_id: string }&#10;">
<path fill="none" stroke="black" d="M1067.89,-3345.84C1067.89,-3313.9 1067.89,-3251 1067.89,-3251 1067.89,-3251 1292.35,-3251 1292.35,-3251"/>
<polygon fill="black" stroke="black" points="1292.35,-3254.5 1302.35,-3251 1292.35,-3247.5 1292.35,-3254.5"/>
</a>
</g>
<text text-anchor="middle" x="1078.2" y="-3243" font-family="Arial" font-size="10.00">AMQP message (JSON)</text>
<text text-anchor="middle" x="1078.2" y="-3232" font-family="Arial" font-size="10.00">{ session_id: string }</text>
</g>
<!-- HTTP_2 -->
<g id="node44" class="node">
<title>HTTP_2</title>
<g id="a_node44"><a xlink:title="HTTP 応答">
<path fill="#ffffff" stroke="black" d="M1418.39,-1909C1418.39,-1909 1367.39,-1909 1367.39,-1909 1361.39,-1909 1355.39,-1903 1355.39,-1897 1355.39,-1897 1355.39,-1885 1355.39,-1885 1355.39,-1879 1361.39,-1873 1367.39,-1873 1367.39,-1873 1418.39,-1873 1418.39,-1873 1424.39,-1873 1430.39,-1879 1430.39,-1885 1430.39,-1885 1430.39,-1897 1430.39,-1897 1430.39,-1903 1424.39,-1909 1418.39,-1909"/>
<text text-anchor="middle" x="1392.89" y="-1887.9" font-family="Arial" font-size="12.00">HTTP 応答</text>
</a>
</g>
</g>
<!-- Session_Manager_Service&#45;&gt;HTTP_2 -->
<g id="edge88" class="edge">
<title>Session_Manager_Service&#45;&gt;HTTP_2</title>
<g id="a_edge88"><a xlink:title="&#45; 刺激ダウンロード時は MinIO オブジェクトをストリーミング&#10;&#45; API 各種のレスポンス JSON">
<path fill="none" stroke="black" d="M1070.02,-3352.5C1121.54,-3352.5 1179.89,-3352.5 1179.89,-3352.5 1179.89,-3352.5 1179.89,-1891 1179.89,-1891 1179.89,-1891 1345.3,-1891 1345.3,-1891"/>
<polygon fill="black" stroke="black" points="1345.3,-1894.5 1355.3,-1891 1345.3,-1887.5 1345.3,-1894.5"/>
</a>
</g>
<text text-anchor="middle" x="1043.39" y="-2585.98" font-family="Arial" font-size="10.00">JSON / ストリーム</text>
<text text-anchor="middle" x="1043.39" y="-2574.98" font-family="Arial" font-size="10.00">&#45; 刺激ダウンロード時は MinIO オブジェクトをストリーミング</text>
<text text-anchor="middle" x="1043.39" y="-2563.98" font-family="Arial" font-size="10.00">&#45; API 各種のレスポンス JSON</text>
</g>
<!-- PostgreSQL&#45;&gt;Auth_Manager_Service -->
<g id="edge9" class="edge">
<title>PostgreSQL&#45;&gt;Auth_Manager_Service</title>
<g id="a_edge9"><a xlink:title="&#45; experiments(password_hash)&#10;&#45; experiment_participants(role, joined_at)&#10;">
<path fill="none" stroke="black" d="M1351.47,-3021C1223.33,-3021 841.89,-3021 841.89,-3021 841.89,-3021 841.89,-3360.4 841.89,-3360.4 841.89,-3360.4 673.07,-3360.4 673.07,-3360.4"/>
<polygon fill="black" stroke="black" points="673.07,-3356.9 663.07,-3360.4 673.07,-3363.9 673.07,-3356.9"/>
</a>
</g>
<text text-anchor="middle" x="931.07" y="-3013" font-family="Arial" font-size="10.00">SQL SELECT</text>
<text text-anchor="middle" x="931.07" y="-3002" font-family="Arial" font-size="10.00">&#45; experiments(password_hash)</text>
<text text-anchor="middle" x="931.07" y="-2991" font-family="Arial" font-size="10.00">&#45; experiment_participants(role, joined_at)</text>
</g>
<!-- PostgreSQL&#45;&gt;Session_Manager_Service -->
<g id="edge82" class="edge">
<title>PostgreSQL&#45;&gt;Session_Manager_Service</title>
<g id="a_edge82"><a xlink:title="&#45; experiments / experiment_participants / experiment_stimuli / sessions / session_events / calibration_items&#10;&#45; 刺激ダウンロード時は experiment_stimuli.object_id を参照&#10;">
<path fill="none" stroke="black" d="M1351.63,-3035C1262.9,-3035 1061.89,-3035 1061.89,-3035 1061.89,-3035 1061.89,-3335.84 1061.89,-3335.84"/>
<polygon fill="black" stroke="black" points="1058.39,-3335.84 1061.89,-3345.84 1065.39,-3335.84 1058.39,-3335.84"/>
</a>
</g>
<text text-anchor="middle" x="1297.39" y="-3065.55" font-family="Arial" font-size="10.00">SQL SELECT</text>
<text text-anchor="middle" x="1297.39" y="-3054.55" font-family="Arial" font-size="10.00">&#45; experiments / experiment_participants / experiment_stimuli / sessions / session_events / calibration_items</text>
<text text-anchor="middle" x="1297.39" y="-3043.55" font-family="Arial" font-size="10.00">&#45; 刺激ダウンロード時は experiment_stimuli.object_id を参照</text>
</g>
<!-- PostgreSQL&#45;&gt;BIDS_Exporter_Service -->
<g id="edge14" class="edge">
<title>PostgreSQL&#45;&gt;BIDS_Exporter_Service</title>
<g id="a_edge14"><a xlink:title="&#45; experiments, sessions (status: event_correction_status=&#39;completed&#39;)&#10;&#45; session_events (onset_corrected_us 優先)&#10;&#45; experiment_stimuli (stimulus_metadata)&#10;&#45; raw_data_objects, images, audio_clips (MinIO オブジェクト参照)&#10;">
<path fill="none" stroke="black" d="M1433.95,-3038C1795.34,-3038 4419.89,-3038 4419.89,-3038 4419.89,-3038 4419.89,-3966.74 4419.89,-3966.74"/>
<polygon fill="black" stroke="black" points="4416.39,-3966.74 4419.89,-3976.74 4423.39,-3966.74 4416.39,-3966.74"/>
</a>
</g>
<text text-anchor="middle" x="3237.79" y="-3030" font-family="Arial" font-size="10.00">SQL SELECT</text>
<text text-anchor="middle" x="3237.79" y="-3019" font-family="Arial" font-size="10.00">&#45; experiments, sessions (status: event_correction_status=&#39;completed&#39;)</text>
<text text-anchor="middle" x="3237.79" y="-3008" font-family="Arial" font-size="10.00">&#45; session_events (onset_corrected_us 優先)</text>
<text text-anchor="middle" x="3237.79" y="-2997" font-family="Arial" font-size="10.00">&#45; experiment_stimuli (stimulus_metadata)</text>
<text text-anchor="middle" x="3237.79" y="-2986" font-family="Arial" font-size="10.00">&#45; raw_data_objects, images, audio_clips (MinIO オブジェクト参照)</text>
</g>
<!-- PostgreSQL&#45;&gt;ERP_Neuro_Marketing_Service -->
<g id="edge34" class="edge">
<title>PostgreSQL&#45;&gt;ERP_Neuro_Marketing_Service</title>
<g id="a_edge34"><a xlink:title="&#45; sessions (event_correction_status=&#39;completed&#39;)&#10;&#45; session_events&#10;&#45; experiment_stimuli (item_name, brand_name, category, gender)&#10;">
<path fill="none" stroke="black" d="M1434.11,-3030C1817.68,-3030 4748.89,-3030 4748.89,-3030 4748.89,-3030 4748.89,-4419.81 4748.89,-4419.81"/>
<polygon fill="black" stroke="black" points="4745.39,-4419.81 4748.89,-4429.81 4752.39,-4419.81 4745.39,-4419.81"/>
</a>
</g>
<text text-anchor="middle" x="3644.9" y="-3022" font-family="Arial" font-size="10.00">SQL SELECT</text>
<text text-anchor="middle" x="3644.9" y="-3011" font-family="Arial" font-size="10.00">&#45; sessions (event_correction_status=&#39;completed&#39;)</text>
<text text-anchor="middle" x="3644.9" y="-3000" font-family="Arial" font-size="10.00">&#45; session_events</text>
<text text-anchor="middle" x="3644.9" y="-2989" font-family="Arial" font-size="10.00">&#45; experiment_stimuli (item_name, brand_name, category, gender)</text>
</g>
<!-- DataLinker_Service -->
<g id="node24" class="node">
<title>DataLinker_Service</title>
<g id="a_node24"><a xlink:title="セッション終了後に実行される非同期ジョブを処理し、raw データ・メディアをセッションと実験に結び付けた上で Event Corrector を起動する。">
<path fill="#e8f0fe" stroke="black" d="M1820.89,-1219C1820.89,-1219 1725.89,-1219 1725.89,-1219 1719.89,-1219 1713.89,-1213 1713.89,-1207 1713.89,-1207 1713.89,-1195 1713.89,-1195 1713.89,-1189 1719.89,-1183 1725.89,-1183 1725.89,-1183 1820.89,-1183 1820.89,-1183 1826.89,-1183 1832.89,-1189 1832.89,-1195 1832.89,-1195 1832.89,-1207 1832.89,-1207 1832.89,-1213 1826.89,-1219 1820.89,-1219"/>
<text text-anchor="middle" x="1773.39" y="-1197.9" font-family="Arial" font-size="12.00">DataLinker Service</text>
</a>
</g>
</g>
<!-- PostgreSQL&#45;&gt;DataLinker_Service -->
<g id="edge27" class="edge">
<title>PostgreSQL&#45;&gt;DataLinker_Service</title>
<g id="a_edge27"><a xlink:title="&#45; sessions&#10;&#45; raw_data_objects (timestamp_start_ms, timestamp_end_ms, sampling_rate, lsb_to_volts)&#10;&#45; images / audio_clips&#10;">
<path fill="none" stroke="black" d="M1434.16,-3010C1525.73,-3010 1737.89,-3010 1737.89,-3010 1737.89,-3010 1737.89,-1229.2 1737.89,-1229.2"/>
<polygon fill="black" stroke="black" points="1741.39,-1229.2 1737.89,-1219.2 1734.39,-1229.2 1741.39,-1229.2"/>
</a>
</g>
<text text-anchor="middle" x="1538.89" y="-2263.46" font-family="Arial" font-size="10.00">SQL SELECT</text>
<text text-anchor="middle" x="1538.89" y="-2252.46" font-family="Arial" font-size="10.00">&#45; sessions</text>
<text text-anchor="middle" x="1538.89" y="-2241.46" font-family="Arial" font-size="10.00">&#45; raw_data_objects (timestamp_start_ms, timestamp_end_ms, sampling_rate, lsb_to_volts)</text>
<text text-anchor="middle" x="1538.89" y="-2230.46" font-family="Arial" font-size="10.00">&#45; images / audio_clips</text>
</g>
<!-- Event_Corrector_Service -->
<g id="node29" class="node">
<title>Event_Corrector_Service</title>
<g id="a_node29"><a xlink:title="DataLinker の後段で実行され、raw データからトリガを再解析してセッションイベントの時刻を補正するワーカー。">
<path fill="#e8f0fe" stroke="black" d="M4478.89,-1528C4478.89,-1528 4359.89,-1528 4359.89,-1528 4353.89,-1528 4347.89,-1522 4347.89,-1516 4347.89,-1516 4347.89,-1504 4347.89,-1504 4347.89,-1498 4353.89,-1492 4359.89,-1492 4359.89,-1492 4478.89,-1492 4478.89,-1492 4484.89,-1492 4490.89,-1498 4490.89,-1504 4490.89,-1504 4490.89,-1516 4490.89,-1516 4490.89,-1522 4484.89,-1528 4478.89,-1528"/>
<text text-anchor="middle" x="4419.39" y="-1506.9" font-family="Arial" font-size="12.00">Event Corrector Service</text>
</a>
</g>
</g>
<!-- PostgreSQL&#45;&gt;Event_Corrector_Service -->
<g id="edge39" class="edge">
<title>PostgreSQL&#45;&gt;Event_Corrector_Service</title>
<g id="a_edge39"><a xlink:title="&#45; session_events (onset, event_id)&#10;&#45; sessions (start_time, experiment_id)&#10;&#45; session_object_links&#10;&#45; raw_data_objects (object_id, timestamp_start_ms, sampling_rate)&#10;">
<path fill="none" stroke="black" d="M1434.2,-3018C1535.1,-3018 1785.89,-3018 1785.89,-3018 1785.89,-3018 1785.89,-1507.43 1785.89,-1507.43 1785.89,-1507.43 4337.58,-1507.43 4337.58,-1507.43"/>
<polygon fill="black" stroke="black" points="4337.58,-1510.93 4347.58,-1507.43 4337.58,-1503.93 4337.58,-1510.93"/>
</a>
</g>
<text text-anchor="middle" x="1984.1" y="-1499.43" font-family="Arial" font-size="10.00">SQL SELECT</text>
<text text-anchor="middle" x="1984.1" y="-1488.43" font-family="Arial" font-size="10.00">&#45; session_events (onset, event_id)</text>
<text text-anchor="middle" x="1984.1" y="-1477.43" font-family="Arial" font-size="10.00">&#45; sessions (start_time, experiment_id)</text>
<text text-anchor="middle" x="1984.1" y="-1466.43" font-family="Arial" font-size="10.00">&#45; session_object_links</text>
<text text-anchor="middle" x="1984.1" y="-1455.43" font-family="Arial" font-size="10.00">&#45; raw_data_objects (object_id, timestamp_start_ms, sampling_rate)</text>
</g>
<!-- BIDS_Exporter_Service&#45;&gt;PostgreSQL -->
<g id="edge18" class="edge">
<title>BIDS_Exporter_Service&#45;&gt;PostgreSQL</title>
<g id="a_edge18"><a xlink:title="export_tasks(task_id, experiment_id, status, progress, result_file_path, error_message)&#10;">
<path fill="none" stroke="black" d="M4453.89,-3976.66C4453.89,-3843.8 4453.89,-3034 4453.89,-3034 4453.89,-3034 1444.13,-3034 1444.13,-3034"/>
<polygon fill="black" stroke="black" points="1444.13,-3030.5 1434.13,-3034 1444.13,-3037.5 1444.13,-3030.5"/>
</a>
</g>
<text text-anchor="middle" x="3610.34" y="-3048" font-family="Arial" font-size="10.00">SQL INSERT/UPDATE</text>
<text text-anchor="middle" x="3610.34" y="-3037" font-family="Arial" font-size="10.00">export_tasks(task_id, experiment_id, status, progress, result_file_path, error_message)</text>
</g>
<!-- BIDS_Exporter_Service&#45;&gt;ERP_Neuro_Marketing_Service -->
<g id="edge33" class="edge">
<title>BIDS_Exporter_Service&#45;&gt;ERP_Neuro_Marketing_Service</title>
<g id="a_edge33"><a xlink:title="POST {BIDS_EXPORTER_URL}/internal/v1/create&#45;bids&#45;for&#45;analysis&#10;Body: { experiment_id: uuid }&#10;レスポンス: { bids_path: string }&#10;">
<path fill="none" stroke="black" d="M4488.04,-4005.8C4584.07,-4005.8 4746.89,-4005.8 4746.89,-4005.8 4746.89,-4005.8 4746.89,-4419.84 4746.89,-4419.84"/>
<polygon fill="black" stroke="black" points="4743.39,-4419.84 4746.89,-4429.84 4750.39,-4419.84 4743.39,-4419.84"/>
</a>
</g>
<text text-anchor="middle" x="4597.89" y="-4075.4" font-family="Arial" font-size="10.00">HTTP POST (JSON)</text>
<text text-anchor="middle" x="4597.89" y="-4064.4" font-family="Arial" font-size="10.00">POST {BIDS_EXPORTER_URL}/internal/v1/create&#45;bids&#45;for&#45;analysis</text>
<text text-anchor="middle" x="4597.89" y="-4053.4" font-family="Arial" font-size="10.00">Body: { experiment_id: uuid }</text>
<text text-anchor="middle" x="4597.89" y="-4042.4" font-family="Arial" font-size="10.00">レスポンス: { bids_path: string }</text>
</g>
<!-- MinIO -->
<g id="node15" class="node">
<title>MinIO</title>
<g id="a_node15"><a xlink:title="MinIO">
<path fill="#ffffff" stroke="black" d="M3975.39,-2853C3975.39,-2853 3945.39,-2853 3945.39,-2853 3939.39,-2853 3933.39,-2847 3933.39,-2841 3933.39,-2841 3933.39,-2829 3933.39,-2829 3933.39,-2823 3939.39,-2817 3945.39,-2817 3945.39,-2817 3975.39,-2817 3975.39,-2817 3981.39,-2817 3987.39,-2823 3987.39,-2829 3987.39,-2829 3987.39,-2841 3987.39,-2841 3987.39,-2847 3981.39,-2853 3975.39,-2853"/>
<text text-anchor="middle" x="3960.39" y="-2831.9" font-family="Arial" font-size="12.00">MinIO</text>
</a>
</g>
</g>
<!-- BIDS_Exporter_Service&#45;&gt;MinIO -->
<g id="edge51" class="edge">
<title>BIDS_Exporter_Service&#45;&gt;MinIO</title>
<g id="a_edge51"><a xlink:title="Bucket: bids&#45;exports (設定値)&#10;Key: bids/{experiment_id}/{timestamp}.zip&#10;">
<path fill="none" stroke="black" d="M4350.87,-3998.6C4270.44,-3998.6 4147.89,-3998.6 4147.89,-3998.6 4147.89,-3998.6 4147.89,-2844 4147.89,-2844 4147.89,-2844 3997.65,-2844 3997.65,-2844"/>
<polygon fill="black" stroke="black" points="3997.65,-2840.5 3987.65,-2844 3997.65,-2847.5 3997.65,-2840.5"/>
</a>
</g>
<text text-anchor="middle" x="4056.89" y="-3439.68" font-family="Arial" font-size="10.00">Object PUT</text>
<text text-anchor="middle" x="4056.89" y="-3428.68" font-family="Arial" font-size="10.00">Bucket: bids&#45;exports (設定値)</text>
<text text-anchor="middle" x="4056.89" y="-3417.68" font-family="Arial" font-size="10.00">Key: bids/{experiment_id}/{timestamp}.zip</text>
</g>
<!-- MinIO_bids_exports_bucket -->
<g id="node16" class="node">
<title>MinIO_bids_exports_bucket</title>
<g id="a_node16"><a xlink:title="MinIO (bids exports bucket)">
<path fill="#ffffff" stroke="black" d="M4901.89,-3941C4901.89,-3941 4764.89,-3941 4764.89,-3941 4758.89,-3941 4752.89,-3935 4752.89,-3929 4752.89,-3929 4752.89,-3917 4752.89,-3917 4752.89,-3911 4758.89,-3905 4764.89,-3905 4764.89,-3905 4901.89,-3905 4901.89,-3905 4907.89,-3905 4913.89,-3911 4913.89,-3917 4913.89,-3917 4913.89,-3929 4913.89,-3929 4913.89,-3935 4907.89,-3941 4901.89,-3941"/>
<text text-anchor="middle" x="4833.39" y="-3919.9" font-family="Arial" font-size="12.00">MinIO (bids exports bucket)</text>
</a>
</g>
</g>
<!-- BIDS_Exporter_Service&#45;&gt;MinIO_bids_exports_bucket -->
<g id="edge16" class="edge">
<title>BIDS_Exporter_Service&#45;&gt;MinIO_bids_exports_bucket</title>
<g id="a_edge16"><a xlink:title="object_name: bids/{experiment_id}/task&#45;{timestamp}.zip (configurable)&#10;">
<path fill="none" stroke="black" d="M4488.16,-3984.2C4591.25,-3984.2 4773.89,-3984.2 4773.89,-3984.2 4773.89,-3984.2 4773.89,-3951.03 4773.89,-3951.03"/>
<polygon fill="black" stroke="black" points="4777.39,-3951.03 4773.89,-3941.03 4770.39,-3951.03 4777.39,-3951.03"/>
</a>
</g>
<text text-anchor="middle" x="4799.61" y="-3976.2" font-family="Arial" font-size="10.00">Object PUT (ZIP)</text>
<text text-anchor="middle" x="4799.61" y="-3965.2" font-family="Arial" font-size="10.00">object_name: bids/{experiment_id}/task&#45;{timestamp}.zip (configurable)</text>
</g>
<!-- Shared_Volume -->
<g id="node17" class="node">
<title>Shared_Volume</title>
<g id="a_node17"><a xlink:title="Shared Volume">
<path fill="#ffffff" stroke="black" d="M4870.89,-4085C4870.89,-4085 4795.89,-4085 4795.89,-4085 4789.89,-4085 4783.89,-4079 4783.89,-4073 4783.89,-4073 4783.89,-4061 4783.89,-4061 4783.89,-4055 4789.89,-4049 4795.89,-4049 4795.89,-4049 4870.89,-4049 4870.89,-4049 4876.89,-4049 4882.89,-4055 4882.89,-4061 4882.89,-4061 4882.89,-4073 4882.89,-4073 4882.89,-4079 4876.89,-4085 4870.89,-4085"/>
<text text-anchor="middle" x="4833.39" y="-4063.9" font-family="Arial" font-size="12.00">Shared Volume</text>
</a>
</g>
</g>
<!-- BIDS_Exporter_Service&#45;&gt;Shared_Volume -->
<g id="edge17" class="edge">
<title>BIDS_Exporter_Service&#45;&gt;Shared_Volume</title>
<g id="a_edge17"><a xlink:title="output_dir = settings.export_output_dir / experiment_id&#10;(内部 API 用、ZIP 化しない)&#10;">
<path fill="none" stroke="black" d="M4488.3,-3991.4C4606.16,-3991.4 4833.89,-3991.4 4833.89,-3991.4 4833.89,-3991.4 4833.89,-4038.7 4833.89,-4038.7"/>
<polygon fill="black" stroke="black" points="4830.39,-4038.7 4833.89,-4048.7 4837.39,-4038.7 4830.39,-4038.7"/>
</a>
</g>
<text text-anchor="middle" x="4803.74" y="-4016.4" font-family="Arial" font-size="10.00">ディレクトリ作成</text>
<text text-anchor="middle" x="4803.74" y="-4005.4" font-family="Arial" font-size="10.00">output_dir = settings.export_output_dir / experiment_id</text>
<text text-anchor="middle" x="4803.74" y="-3994.4" font-family="Arial" font-size="10.00">(内部 API 用、ZIP 化しない)</text>
</g>
<!-- HTTP -->
<g id="node18" class="node">
<title>HTTP</title>
<g id="a_node18"><a xlink:title="HTTP クライアント">
<path fill="#ffffff" stroke="black" d="M3132.39,-2055C3132.39,-2055 3033.39,-2055 3033.39,-2055 3027.39,-2055 3021.39,-2049 3021.39,-2043 3021.39,-2043 3021.39,-2031 3021.39,-2031 3021.39,-2025 3027.39,-2019 3033.39,-2019 3033.39,-2019 3132.39,-2019 3132.39,-2019 3138.39,-2019 3144.39,-2025 3144.39,-2031 3144.39,-2031 3144.39,-2043 3144.39,-2043 3144.39,-2049 3138.39,-2055 3132.39,-2055"/>
<text text-anchor="middle" x="3082.89" y="-2033.9" font-family="Arial" font-size="12.00">HTTP クライアント</text>
</a>
</g>
</g>
<!-- BIDS_Exporter_Service&#45;&gt;HTTP -->
<g id="edge19" class="edge">
<title>BIDS_Exporter_Service&#45;&gt;HTTP</title>
<g id="a_edge19"><a xlink:title="&#45; ExportResponse: {task_id,status,message,status_url}&#10;&#45; TaskStatus: {task_id, experiment_id, status, progress, result_file_path?, error_message?}&#10;&#45; ダウンロード: application/zip ストリーム">
<path fill="none" stroke="black" d="M4350.52,-3984.2C4305.84,-3984.2 4255.89,-3984.2 4255.89,-3984.2 4255.89,-3984.2 4255.89,-2037 4255.89,-2037 4255.89,-2037 3154.71,-2037 3154.71,-2037"/>
<polygon fill="black" stroke="black" points="3154.71,-2033.5 3144.71,-2037 3154.71,-2040.5 3154.71,-2033.5"/>
</a>
</g>
<text text-anchor="middle" x="4058.39" y="-2499.33" font-family="Arial" font-size="10.00">JSON / ストリーム</text>
<text text-anchor="middle" x="4058.39" y="-2488.33" font-family="Arial" font-size="10.00">&#45; ExportResponse: {task_id,status,message,status_url}</text>
<text text-anchor="middle" x="4058.39" y="-2477.33" font-family="Arial" font-size="10.00">&#45; TaskStatus: {task_id, experiment_id, status, progress, result_file_path?, error_message?}</text>
<text text-anchor="middle" x="4058.39" y="-2466.33" font-family="Arial" font-size="10.00">&#45; ダウンロード: application/zip ストリーム</text>
</g>
<!-- Session_Manager_Service_External_dashboard -->
<g id="node13" class="node">
<title>Session_Manager_Service_External_dashboard</title>
<g id="a_node13"><a xlink:title="Session Manager Service / External dashboard">
<path fill="#ffffff" stroke="black" d="M4081.89,-4013C4081.89,-4013 3838.89,-4013 3838.89,-4013 3832.89,-4013 3826.89,-4007 3826.89,-4001 3826.89,-4001 3826.89,-3989 3826.89,-3989 3826.89,-3983 3832.89,-3977 3838.89,-3977 3838.89,-3977 4081.89,-3977 4081.89,-3977 4087.89,-3977 4093.89,-3983 4093.89,-3989 4093.89,-3989 4093.89,-4001 4093.89,-4001 4093.89,-4007 4087.89,-4013 4081.89,-4013"/>
<text text-anchor="middle" x="3960.39" y="-3991.9" font-family="Arial" font-size="12.00">Session Manager Service / External dashboard</text>
</a>
</g>
</g>
<!-- Session_Manager_Service_External_dashboard&#45;&gt;BIDS_Exporter_Service -->
<g id="edge12" class="edge">
<title>Session_Manager_Service_External_dashboard&#45;&gt;BIDS_Exporter_Service</title>
<g id="a_edge12"><a xlink:title="POST /api/v1/experiments/{experiment_id}/export&#10;Body: なし (header で X&#45;User&#45;Id を透過)&#10;">
<path fill="none" stroke="black" d="M4094.07,-4005.8C4094.07,-4005.8 4340.59,-4005.8 4340.59,-4005.8"/>
<polygon fill="black" stroke="black" points="4340.59,-4009.3 4350.59,-4005.8 4340.59,-4002.3 4340.59,-4009.3"/>
</a>
</g>
<text text-anchor="middle" x="4325.33" y="-4030.8" font-family="Arial" font-size="10.00">HTTP POST</text>
<text text-anchor="middle" x="4325.33" y="-4019.8" font-family="Arial" font-size="10.00">POST /api/v1/experiments/{experiment_id}/export</text>
<text text-anchor="middle" x="4325.33" y="-4008.8" font-family="Arial" font-size="10.00">Body: なし (header で X&#45;User&#45;Id を透過)</text>
</g>
<!-- ERP_Neuro_Marketing_Service&#45;&gt;BIDS_Exporter_Service -->
<g id="edge13" class="edge">
<title>ERP_Neuro_Marketing_Service&#45;&gt;BIDS_Exporter_Service</title>
<g id="a_edge13"><a xlink:title="POST /internal/v1/create&#45;bids&#45;for&#45;analysis&#10;Body: { experiment_id: uuid }&#10;">
<path fill="none" stroke="black" d="M4763.89,-4429.83C4763.89,-4345.75 4763.89,-3998.6 4763.89,-3998.6 4763.89,-3998.6 4498.27,-3998.6 4498.27,-3998.6"/>
<polygon fill="black" stroke="black" points="4498.27,-3995.1 4488.27,-3998.6 4498.27,-4002.1 4498.27,-3995.1"/>
</a>
</g>
<text text-anchor="middle" x="4672.39" y="-4106.41" font-family="Arial" font-size="10.00">HTTP POST (JSON)</text>
<text text-anchor="middle" x="4672.39" y="-4095.41" font-family="Arial" font-size="10.00">POST /internal/v1/create&#45;bids&#45;for&#45;analysis</text>
<text text-anchor="middle" x="4672.39" y="-4084.41" font-family="Arial" font-size="10.00">Body: { experiment_id: uuid }</text>
</g>
<!-- ERP_Neuro_Marketing_Service&#45;&gt;HTTP -->
<g id="edge35" class="edge">
<title>ERP_Neuro_Marketing_Service&#45;&gt;HTTP</title>
<g id="a_edge35"><a xlink:title="AnalysisResponse:&#10; &#160;experiment_id: uuid&#10; &#160;recommendations: [{ file_name, item_name?, brand_name?, description?, category?, gender? }]&#10; &#160;summary: string&#10;">
<path fill="none" stroke="black" d="M4750.89,-4429.93C4750.89,-4208.76 4750.89,-2031 4750.89,-2031 4750.89,-2031 3154.48,-2031 3154.48,-2031"/>
<polygon fill="black" stroke="black" points="3154.48,-2027.5 3144.48,-2031 3154.48,-2034.5 3154.48,-2027.5"/>
</a>
</g>
<text text-anchor="middle" x="4540.39" y="-2424.26" font-family="Arial" font-size="10.00">JSON</text>
<text text-anchor="middle" x="4540.39" y="-2413.26" font-family="Arial" font-size="10.00">AnalysisResponse:</text>
<text text-anchor="middle" x="4540.39" y="-2402.26" font-family="Arial" font-size="10.00"> &#160;experiment_id: uuid</text>
<text text-anchor="middle" x="4540.39" y="-2391.26" font-family="Arial" font-size="10.00"> &#160;recommendations: [{ file_name, item_name?, brand_name?, description?, category?, gender? }]</text>
<text text-anchor="middle" x="4540.39" y="-2380.26" font-family="Arial" font-size="10.00"> &#160;summary: string</text>
</g>
<!-- node_6 -->
<g id="node28" class="node">
<title>node_6</title>
<g id="a_node28"><a xlink:title="ログ">
<path fill="#ffffff" stroke="black" d="M5215.39,-4466C5215.39,-4466 5185.39,-4466 5185.39,-4466 5179.39,-4466 5173.39,-4460 5173.39,-4454 5173.39,-4454 5173.39,-4442 5173.39,-4442 5173.39,-4436 5179.39,-4430 5185.39,-4430 5185.39,-4430 5215.39,-4430 5215.39,-4430 5221.39,-4430 5227.39,-4436 5227.39,-4442 5227.39,-4442 5227.39,-4454 5227.39,-4454 5227.39,-4460 5221.39,-4466 5215.39,-4466"/>
<text text-anchor="middle" x="5200.39" y="-4444.9" font-family="Arial" font-size="12.00">ログ</text>
</a>
</g>
</g>
<!-- ERP_Neuro_Marketing_Service&#45;&gt;node_6 -->
<g id="edge36" class="edge">
<title>ERP_Neuro_Marketing_Service&#45;&gt;node_6</title>
<g id="a_edge36"><a xlink:title="INFO/ERROR ログを標準出力へ。解析手順・外部 API の失敗を記録。">
<path fill="none" stroke="black" d="M4922.23,-4448C4922.23,-4448 5163.02,-4448 5163.02,-4448"/>
<polygon fill="black" stroke="black" points="5163.02,-4451.5 5173.02,-4448 5163.02,-4444.5 5163.02,-4451.5"/>
</a>
</g>
<text text-anchor="middle" x="5199.62" y="-4440" font-family="Arial" font-size="10.00">構造化ログ</text>
<text text-anchor="middle" x="5199.62" y="-4429" font-family="Arial" font-size="10.00">INFO/ERROR ログを標準出力へ。解析手順・外部 API の失敗を記録。</text>
</g>
<!-- MinIO&#45;&gt;Session_Manager_Service -->
<g id="edge52" class="edge">
<title>MinIO&#45;&gt;Session_Manager_Service</title>
<g id="a_edge52"><a xlink:title="&#45; キャリブレーション刺激: calibration_items.object_id&#10;&#45; 実験刺激: experiment_stimuli.object_id&#10;">
<path fill="none" stroke="black" d="M3933.03,-2841C3638,-2841 1055.89,-2841 1055.89,-2841 1055.89,-2841 1055.89,-3336 1055.89,-3336"/>
<polygon fill="black" stroke="black" points="1052.39,-3336 1055.89,-3346 1059.39,-3336 1052.39,-3336"/>
</a>
</g>
<text text-anchor="middle" x="2129.46" y="-2833" font-family="Arial" font-size="10.00">Object GET</text>
<text text-anchor="middle" x="2129.46" y="-2822" font-family="Arial" font-size="10.00">&#45; キャリブレーション刺激: calibration_items.object_id</text>
<text text-anchor="middle" x="2129.46" y="-2811" font-family="Arial" font-size="10.00">&#45; 実験刺激: experiment_stimuli.object_id</text>
</g>
<!-- MinIO&#45;&gt;BIDS_Exporter_Service -->
<g id="edge15" class="edge">
<title>MinIO&#45;&gt;BIDS_Exporter_Service</title>
<g id="a_edge15"><a xlink:title="&#45; raw&#45;data バケット: 生信号バイナリ (.bin)&#10;&#45; media バケット: 刺激ファイル&#10;">
<path fill="none" stroke="black" d="M3987.62,-2835C4050.78,-2835 4201.89,-2835 4201.89,-2835 4201.89,-2835 4201.89,-3991.4 4201.89,-3991.4 4201.89,-3991.4 4340.87,-3991.4 4340.87,-3991.4"/>
<polygon fill="black" stroke="black" points="4340.87,-3994.9 4350.87,-3991.4 4340.87,-3987.9 4340.87,-3994.9"/>
</a>
</g>
<text text-anchor="middle" x="4109.39" y="-3367.56" font-family="Arial" font-size="10.00">Object GET</text>
<text text-anchor="middle" x="4109.39" y="-3356.56" font-family="Arial" font-size="10.00">&#45; raw&#45;data バケット: 生信号バイナリ (.bin)</text>
<text text-anchor="middle" x="4109.39" y="-3345.56" font-family="Arial" font-size="10.00">&#45; media バケット: 刺激ファイル</text>
</g>
<!-- MinIO&#45;&gt;Event_Corrector_Service -->
<g id="edge53" class="edge">
<title>MinIO&#45;&gt;Event_Corrector_Service</title>
<g id="a_edge53"><a xlink:title="raw&#45;data バケットの .bin をダウンロードしてトリガ解析&#10;">
<path fill="none" stroke="black" d="M3973.89,-2816.95C3973.89,-2659.35 3973.89,-1522.86 3973.89,-1522.86 3973.89,-1522.86 4337.81,-1522.86 4337.81,-1522.86"/>
<polygon fill="black" stroke="black" points="4337.81,-1526.36 4347.81,-1522.86 4337.81,-1519.36 4337.81,-1526.36"/>
</a>
</g>
<text text-anchor="middle" x="3849.89" y="-1979.94" font-family="Arial" font-size="10.00">Object GET</text>
<text text-anchor="middle" x="3849.89" y="-1968.94" font-family="Arial" font-size="10.00">raw&#45;data バケットの .bin をダウンロードしてトリガ解析</text>
</g>
<!-- BIDS_Exporter_ERP_Neuro_Marketing -->
<g id="node35" class="node">
<title>BIDS_Exporter_ERP_Neuro_Marketing</title>
<g id="a_node35"><a xlink:title="BIDS Exporter / ERP Neuro&#45;Marketing">
<path fill="#ffffff" stroke="black" d="M4516.89,-2853C4516.89,-2853 4321.89,-2853 4321.89,-2853 4315.89,-2853 4309.89,-2847 4309.89,-2841 4309.89,-2841 4309.89,-2829 4309.89,-2829 4309.89,-2823 4315.89,-2817 4321.89,-2817 4321.89,-2817 4516.89,-2817 4516.89,-2817 4522.89,-2817 4528.89,-2823 4528.89,-2829 4528.89,-2829 4528.89,-2841 4528.89,-2841 4528.89,-2847 4522.89,-2853 4516.89,-2853"/>
<text text-anchor="middle" x="4419.39" y="-2831.9" font-family="Arial" font-size="12.00">BIDS Exporter / ERP Neuro&#45;Marketing</text>
</a>
</g>
</g>
<!-- MinIO&#45;&gt;BIDS_Exporter_ERP_Neuro_Marketing -->
<g id="edge54" class="edge">
<title>MinIO&#45;&gt;BIDS_Exporter_ERP_Neuro_Marketing</title>
<g id="a_edge54"><a xlink:title="&#45; 生データ / メディアを取得して BIDS を構築&#10;&#45; 生成済み ZIP をダウンロード (公開 API)">
<path fill="none" stroke="black" d="M3987.72,-2826C3987.72,-2826 4299.85,-2826 4299.85,-2826"/>
<polygon fill="black" stroke="black" points="4299.85,-2829.5 4309.85,-2826 4299.85,-2822.5 4299.85,-2829.5"/>
</a>
</g>
<text text-anchor="middle" x="4244.79" y="-2818" font-family="Arial" font-size="10.00">Object GET</text>
<text text-anchor="middle" x="4244.79" y="-2807" font-family="Arial" font-size="10.00">&#45; 生データ / メディアを取得して BIDS を構築</text>
<text text-anchor="middle" x="4244.79" y="-2796" font-family="Arial" font-size="10.00">&#45; 生成済み ZIP をダウンロード (公開 API)</text>
</g>
<!-- HTTP&#45;&gt;DataLinker_Service -->
<g id="edge26" class="edge">
<title>HTTP&#45;&gt;DataLinker_Service</title>
<g id="a_edge26"><a xlink:title="POST /api/v1/jobs&#10;Body: { session_id: string }&#10;">
<path fill="none" stroke="black" d="M3021.06,-2036C2766.12,-2036 1809.89,-2036 1809.89,-2036 1809.89,-2036 1809.89,-1229.22 1809.89,-1229.22"/>
<polygon fill="black" stroke="black" points="1813.39,-1229.22 1809.89,-1219.22 1806.39,-1229.22 1813.39,-1229.22"/>
</a>
</g>
<text text-anchor="middle" x="1953.08" y="-2028" font-family="Arial" font-size="10.00">HTTP POST (JSON)</text>
<text text-anchor="middle" x="1953.08" y="-2017" font-family="Arial" font-size="10.00">POST /api/v1/jobs</text>
<text text-anchor="middle" x="1953.08" y="-2006" font-family="Arial" font-size="10.00">Body: { session_id: string }</text>
</g>
<!-- HTTP&#45;&gt;Event_Corrector_Service -->
<g id="edge38" class="edge">
<title>HTTP&#45;&gt;Event_Corrector_Service</title>
<g id="a_edge38"><a xlink:title="POST /api/v1/jobs&#10;Body: { session_id: string }&#10;">
<path fill="none" stroke="black" d="M3103.89,-2018.82C3103.89,-1926.91 3103.89,-1517.71 3103.89,-1517.71 3103.89,-1517.71 4337.72,-1517.71 4337.72,-1517.71"/>
<polygon fill="black" stroke="black" points="4337.72,-1521.21 4347.72,-1517.71 4337.72,-1514.21 4337.72,-1521.21"/>
</a>
</g>
<text text-anchor="middle" x="3411.25" y="-1509.71" font-family="Arial" font-size="10.00">HTTP POST (JSON)</text>
<text text-anchor="middle" x="3411.25" y="-1498.71" font-family="Arial" font-size="10.00">POST /api/v1/jobs</text>
<text text-anchor="middle" x="3411.25" y="-1487.71" font-family="Arial" font-size="10.00">Body: { session_id: string }</text>
</g>
<!-- Media_Processor_Service -->
<g id="node31" class="node">
<title>Media_Processor_Service</title>
<g id="a_node31"><a xlink:title="Collector からキューイングされた画像・音声を MinIO へ保存し、メタデータを PostgreSQL に登録するコンシューマ。">
<path fill="#e8f0fe" stroke="black" d="M3575.39,-2236C3575.39,-2236 3449.39,-2236 3449.39,-2236 3443.39,-2236 3437.39,-2230 3437.39,-2224 3437.39,-2224 3437.39,-2212 3437.39,-2212 3437.39,-2206 3443.39,-2200 3449.39,-2200 3449.39,-2200 3575.39,-2200 3575.39,-2200 3581.39,-2200 3587.39,-2206 3587.39,-2212 3587.39,-2212 3587.39,-2224 3587.39,-2224 3587.39,-2230 3581.39,-2236 3575.39,-2236"/>
<text text-anchor="middle" x="3512.39" y="-2214.9" font-family="Arial" font-size="12.00">Media Processor Service</text>
</a>
</g>
</g>
<!-- HTTP&#45;&gt;Media_Processor_Service -->
<g id="edge44" class="edge">
<title>HTTP&#45;&gt;Media_Processor_Service</title>
<g id="a_edge44"><a xlink:title="POST /api/v1/preview&#45;object&#45;id&#10;Body:&#10; &#160;user_id: string&#10; &#160;session_id: string&#10; &#160;mimetype: string&#10; &#160;original_filename: string&#10; &#160;timestamp_utc?: string&#10; &#160;start_time_utc?: string&#10; &#160;end_time_utc?: string&#10;">
<path fill="none" stroke="black" d="M3144.6,-2043C3247.24,-2043 3441.89,-2043 3441.89,-2043 3441.89,-2043 3441.89,-2189.93 3441.89,-2189.93"/>
<polygon fill="black" stroke="black" points="3438.39,-2189.93 3441.89,-2199.93 3445.39,-2189.93 3438.39,-2189.93"/>
</a>
</g>
<text text-anchor="middle" x="3298.71" y="-2035" font-family="Arial" font-size="10.00">HTTP POST (JSON)</text>
<text text-anchor="middle" x="3298.71" y="-2024" font-family="Arial" font-size="10.00">POST /api/v1/preview&#45;object&#45;id</text>
<text text-anchor="middle" x="3298.71" y="-2013" font-family="Arial" font-size="10.00">Body:</text>
<text text-anchor="middle" x="3298.71" y="-2002" font-family="Arial" font-size="10.00"> &#160;user_id: string</text>
<text text-anchor="middle" x="3298.71" y="-1991" font-family="Arial" font-size="10.00"> &#160;session_id: string</text>
<text text-anchor="middle" x="3298.71" y="-1980" font-family="Arial" font-size="10.00"> &#160;mimetype: string</text>
<text text-anchor="middle" x="3298.71" y="-1969" font-family="Arial" font-size="10.00"> &#160;original_filename: string</text>
<text text-anchor="middle" x="3298.71" y="-1958" font-family="Arial" font-size="10.00"> &#160;timestamp_utc?: string</text>
<text text-anchor="middle" x="3298.71" y="-1947" font-family="Arial" font-size="10.00"> &#160;start_time_utc?: string</text>
<text text-anchor="middle" x="3298.71" y="-1936" font-family="Arial" font-size="10.00"> &#160;end_time_utc?: string</text>
</g>
<!-- Processor_Service -->
<g id="node33" class="node">
<title>Processor_Service</title>
<g id="a_node33"><a xlink:title="Processor Service">
<path fill="#ffffff" stroke="black" d="M3557.39,-1293C3557.39,-1293 3467.39,-1293 3467.39,-1293 3461.39,-1293 3455.39,-1287 3455.39,-1281 3455.39,-1281 3455.39,-1269 3455.39,-1269 3455.39,-1263 3461.39,-1257 3467.39,-1257 3467.39,-1257 3557.39,-1257 3557.39,-1257 3563.39,-1257 3569.39,-1263 3569.39,-1269 3569.39,-1269 3569.39,-1281 3569.39,-1281 3569.39,-1287 3563.39,-1293 3557.39,-1293"/>
<text text-anchor="middle" x="3512.39" y="-1271.9" font-family="Arial" font-size="12.00">Processor Service</text>
</a>
</g>
</g>
<!-- HTTP&#45;&gt;Processor_Service -->
<g id="edge63" class="edge">
<title>HTTP&#45;&gt;Processor_Service</title>
<g id="a_edge63"><a xlink:title="POST /api/v1/inspect&#10;Body:&#10; &#160;payload_base64: string&#10; &#160;sampling_rate: number&#10;">
<path fill="none" stroke="black" d="M3144.49,-2025C3263.39,-2025 3512.89,-2025 3512.89,-2025 3512.89,-2025 3512.89,-1303.17 3512.89,-1303.17"/>
<polygon fill="black" stroke="black" points="3516.39,-1303.17 3512.89,-1293.17 3509.39,-1303.17 3516.39,-1303.17"/>
</a>
</g>
<text text-anchor="middle" x="3459.39" y="-1840.28" font-family="Arial" font-size="10.00">HTTP POST (JSON)</text>
<text text-anchor="middle" x="3459.39" y="-1829.28" font-family="Arial" font-size="10.00">POST /api/v1/inspect</text>
<text text-anchor="middle" x="3459.39" y="-1818.28" font-family="Arial" font-size="10.00">Body:</text>
<text text-anchor="middle" x="3459.39" y="-1807.28" font-family="Arial" font-size="10.00"> &#160;payload_base64: string</text>
<text text-anchor="middle" x="3459.39" y="-1796.28" font-family="Arial" font-size="10.00"> &#160;sampling_rate: number</text>
</g>
<!-- Stimulus_Asset_Processor_Service -->
<g id="node34" class="node">
<title>Stimulus_Asset_Processor_Service</title>
<g id="a_node34"><a xlink:title="Stimulus Asset Processor Service">
<path fill="#ffffff" stroke="black" d="M3598.89,-2725C3598.89,-2725 3425.89,-2725 3425.89,-2725 3419.89,-2725 3413.89,-2719 3413.89,-2713 3413.89,-2713 3413.89,-2701 3413.89,-2701 3413.89,-2695 3419.89,-2689 3425.89,-2689 3425.89,-2689 3598.89,-2689 3598.89,-2689 3604.89,-2689 3610.89,-2695 3610.89,-2701 3610.89,-2701 3610.89,-2713 3610.89,-2713 3610.89,-2719 3604.89,-2725 3598.89,-2725"/>
<text text-anchor="middle" x="3512.39" y="-2703.9" font-family="Arial" font-size="12.00">Stimulus Asset Processor Service</text>
</a>
</g>
</g>
<!-- HTTP&#45;&gt;Stimulus_Asset_Processor_Service -->
<g id="edge90" class="edge">
<title>HTTP&#45;&gt;Stimulus_Asset_Processor_Service</title>
<g id="a_edge90"><a xlink:title="POST /api/v1/jobs&#10;Body: StimulusAssetJobPayload (上記と同型)&#10;">
<path fill="none" stroke="black" d="M3144.6,-2049C3243.35,-2049 3425.89,-2049 3425.89,-2049 3425.89,-2049 3425.89,-2678.71 3425.89,-2678.71"/>
<polygon fill="black" stroke="black" points="3422.39,-2678.71 3425.89,-2688.71 3429.39,-2678.71 3422.39,-2678.71"/>
</a>
</g>
<text text-anchor="middle" x="3324.89" y="-2215.22" font-family="Arial" font-size="10.00">HTTP POST (JSON)</text>
<text text-anchor="middle" x="3324.89" y="-2204.22" font-family="Arial" font-size="10.00">POST /api/v1/jobs</text>
<text text-anchor="middle" x="3324.89" y="-2193.22" font-family="Arial" font-size="10.00">Body: StimulusAssetJobPayload (上記と同型)</text>
</g>
<!-- Collector_Service -->
<g id="node19" class="node">
<title>Collector_Service</title>
<g id="a_node19"><a xlink:title="スマホアプリから送られるセンサーデータとメディアを受け取り、RabbitMQ 経由で下流処理サービスへ配信する入口ゲートウェイ。">
<path fill="#e8f0fe" stroke="black" d="M1815.39,-622C1815.39,-622 1731.39,-622 1731.39,-622 1725.39,-622 1719.39,-616 1719.39,-610 1719.39,-610 1719.39,-598 1719.39,-598 1719.39,-592 1725.39,-586 1731.39,-586 1731.39,-586 1815.39,-586 1815.39,-586 1821.39,-586 1827.39,-592 1827.39,-598 1827.39,-598 1827.39,-610 1827.39,-610 1827.39,-616 1821.39,-622 1815.39,-622"/>
<text text-anchor="middle" x="1773.39" y="-600.9" font-family="Arial" font-size="12.00">Collector Service</text>
</a>
</g>
</g>
<!-- RabbitMQ_exchange_raw_data_exchange -->
<g id="node21" class="node">
<title>RabbitMQ_exchange_raw_data_exchange</title>
<g id="a_node21"><a xlink:title="RabbitMQ exchange raw_data_exchange">
<path fill="#ffffff" stroke="black" d="M2274.89,-423C2274.89,-423 2060.89,-423 2060.89,-423 2054.89,-423 2048.89,-417 2048.89,-411 2048.89,-411 2048.89,-399 2048.89,-399 2048.89,-393 2054.89,-387 2060.89,-387 2060.89,-387 2274.89,-387 2274.89,-387 2280.89,-387 2286.89,-393 2286.89,-399 2286.89,-399 2286.89,-411 2286.89,-411 2286.89,-417 2280.89,-423 2274.89,-423"/>
<text text-anchor="middle" x="2167.89" y="-401.9" font-family="Arial" font-size="12.00">RabbitMQ exchange raw_data_exchange</text>
</a>
</g>
</g>
<!-- Collector_Service&#45;&gt;RabbitMQ_exchange_raw_data_exchange -->
<g id="edge22" class="edge">
<title>Collector_Service&#45;&gt;RabbitMQ_exchange_raw_data_exchange</title>
<g id="a_edge22"><a xlink:title="Exchange: config.RAW_DATA_EXCHANGE (fanout)&#10;Headers:&#10; &#160;user_id, device_id, timestamp_start_ms, timestamp_end_ms,&#10; &#160;sampling_rate, lsb_to_volts, session_id?&#10;Body: zstd 圧縮バイナリ (Collector 側ではエラーチェックのみ)&#10;">
<path fill="none" stroke="black" d="M1827.63,-595C1917.36,-595 2086.89,-595 2086.89,-595 2086.89,-595 2086.89,-433.22 2086.89,-433.22"/>
<polygon fill="black" stroke="black" points="2090.39,-433.22 2086.89,-423.22 2083.39,-433.22 2090.39,-433.22"/>
</a>
</g>
<text text-anchor="middle" x="2176.65" y="-653" font-family="Arial" font-size="10.00">AMQP fanout message</text>
<text text-anchor="middle" x="2176.65" y="-642" font-family="Arial" font-size="10.00">Exchange: config.RAW_DATA_EXCHANGE (fanout)</text>
<text text-anchor="middle" x="2176.65" y="-631" font-family="Arial" font-size="10.00">Headers:</text>
<text text-anchor="middle" x="2176.65" y="-620" font-family="Arial" font-size="10.00"> &#160;user_id, device_id, timestamp_start_ms, timestamp_end_ms,</text>
<text text-anchor="middle" x="2176.65" y="-609" font-family="Arial" font-size="10.00"> &#160;sampling_rate, lsb_to_volts, session_id?</text>
<text text-anchor="middle" x="2176.65" y="-598" font-family="Arial" font-size="10.00">Body: zstd 圧縮バイナリ (Collector 側ではエラーチェックのみ)</text>
</g>
<!-- RabbitMQ_queue_media_processing_queue -->
<g id="node22" class="node">
<title>RabbitMQ_queue_media_processing_queue</title>
<g id="a_node22"><a xlink:title="RabbitMQ queue media_processing_queue">
<path fill="#ffffff" stroke="black" d="M2739.89,-857C2739.89,-857 2514.89,-857 2514.89,-857 2508.89,-857 2502.89,-851 2502.89,-845 2502.89,-845 2502.89,-833 2502.89,-833 2502.89,-827 2508.89,-821 2514.89,-821 2514.89,-821 2739.89,-821 2739.89,-821 2745.89,-821 2751.89,-827 2751.89,-833 2751.89,-833 2751.89,-845 2751.89,-845 2751.89,-851 2745.89,-857 2739.89,-857"/>
<text text-anchor="middle" x="2627.39" y="-835.9" font-family="Arial" font-size="12.00">RabbitMQ queue media_processing_queue</text>
</a>
</g>
</g>
<!-- Collector_Service&#45;&gt;RabbitMQ_queue_media_processing_queue -->
<g id="edge23" class="edge">
<title>Collector_Service&#45;&gt;RabbitMQ_queue_media_processing_queue</title>
<g id="a_edge23"><a xlink:title="Headers:&#10; &#160;user_id, session_id, mimetype, original_filename,&#10; &#160;timestamp_utc?, start_time_utc?, end_time_utc?&#10;Body: バイナリファイルの生データ&#10;">
<path fill="none" stroke="black" d="M1827.42,-604C2000.33,-604 2528.89,-604 2528.89,-604 2528.89,-604 2528.89,-810.95 2528.89,-810.95"/>
<polygon fill="black" stroke="black" points="2525.39,-810.95 2528.89,-820.95 2532.39,-810.95 2525.39,-810.95"/>
</a>
</g>
<text text-anchor="middle" x="2392.13" y="-596" font-family="Arial" font-size="10.00">AMQP persistent message</text>
<text text-anchor="middle" x="2392.13" y="-585" font-family="Arial" font-size="10.00">Headers:</text>
<text text-anchor="middle" x="2392.13" y="-574" font-family="Arial" font-size="10.00"> &#160;user_id, session_id, mimetype, original_filename,</text>
<text text-anchor="middle" x="2392.13" y="-563" font-family="Arial" font-size="10.00"> &#160;timestamp_utc?, start_time_utc?, end_time_utc?</text>
<text text-anchor="middle" x="2392.13" y="-552" font-family="Arial" font-size="10.00">Body: バイナリファイルの生データ</text>
</g>
<!-- node_5 -->
<g id="node23" class="node">
<title>node_5</title>
<g id="a_node23"><a xlink:title="監視クライアント">
<path fill="#ffffff" stroke="black" d="M4877.89,-894C4877.89,-894 4788.89,-894 4788.89,-894 4782.89,-894 4776.89,-888 4776.89,-882 4776.89,-882 4776.89,-870 4776.89,-870 4776.89,-864 4782.89,-858 4788.89,-858 4788.89,-858 4877.89,-858 4877.89,-858 4883.89,-858 4889.89,-864 4889.89,-870 4889.89,-870 4889.89,-882 4889.89,-882 4889.89,-888 4883.89,-894 4877.89,-894"/>
<text text-anchor="middle" x="4833.39" y="-872.9" font-family="Arial" font-size="12.00">監視クライアント</text>
</a>
</g>
</g>
<!-- Collector_Service&#45;&gt;node_5 -->
<g id="edge24" class="edge">
<title>Collector_Service&#45;&gt;node_5</title>
<g id="a_edge24"><a xlink:title="ヘルスチェック:&#10; &#160;GET /health &#45;&gt; {status:&#39;ok&#39;|&#39;unhealthy&#39;}&#10; &#160;GET /api/v1/health &#45;&gt; {status, service, rabbitmq_connected, last_connected_at?}">
<path fill="none" stroke="black" d="M1773.89,-622.37C1773.89,-681.82 1773.89,-865.2 1773.89,-865.2 1773.89,-865.2 4766.68,-865.2 4766.68,-865.2"/>
<polygon fill="black" stroke="black" points="4766.68,-868.7 4776.68,-865.2 4766.68,-861.7 4766.68,-868.7"/>
</a>
</g>
<text text-anchor="middle" x="2969.86" y="-857.2" font-family="Arial" font-size="10.00">HTTP JSON</text>
<text text-anchor="middle" x="2969.86" y="-846.2" font-family="Arial" font-size="10.00">ヘルスチェック:</text>
<text text-anchor="middle" x="2969.86" y="-835.2" font-family="Arial" font-size="10.00"> &#160;GET /health &#45;&gt; {status:&#39;ok&#39;|&#39;unhealthy&#39;}</text>
<text text-anchor="middle" x="2969.86" y="-824.2" font-family="Arial" font-size="10.00"> &#160;GET /api/v1/health &#45;&gt; {status, service, rabbitmq_connected, last_connected_at?}</text>
</g>
<!-- Collector_Service&#45;&gt;RabbitMQ -->
<g id="edge67" class="edge">
<title>Collector_Service&#45;&gt;RabbitMQ</title>
<g id="a_edge67"><a xlink:title="Exchange: raw_data_exchange (fanout)&#10;Routing key: &#39;&#39; (全購読者へ配信)&#10;Payload: zstd 圧縮バイナリ、ヘッダーに計測メタデータ&#10;">
<path fill="none" stroke="black" d="M1827.41,-613C1935.46,-613 2167.89,-613 2167.89,-613 2167.89,-613 2167.89,-991.99 2167.89,-991.99"/>
<polygon fill="black" stroke="black" points="2164.39,-991.99 2167.89,-1001.99 2171.39,-991.99 2164.39,-991.99"/>
</a>
</g>
<text text-anchor="middle" x="2043.39" y="-668.26" font-family="Arial" font-size="10.00">AMQP publish</text>
<text text-anchor="middle" x="2043.39" y="-657.26" font-family="Arial" font-size="10.00">Exchange: raw_data_exchange (fanout)</text>
<text text-anchor="middle" x="2043.39" y="-646.26" font-family="Arial" font-size="10.00">Routing key: &#39;&#39; (全購読者へ配信)</text>
<text text-anchor="middle" x="2043.39" y="-635.26" font-family="Arial" font-size="10.00">Payload: zstd 圧縮バイナリ、ヘッダーに計測メタデータ</text>
</g>
<!-- node_4 -->
<g id="node20" class="node">
<title>node_4</title>
<g id="a_node20"><a xlink:title="スマホアプリ / エッジデバイス">
<path fill="#ffffff" stroke="black" d="M1471.89,-622C1471.89,-622 1313.89,-622 1313.89,-622 1307.89,-622 1301.89,-616 1301.89,-610 1301.89,-610 1301.89,-598 1301.89,-598 1301.89,-592 1307.89,-586 1313.89,-586 1313.89,-586 1471.89,-586 1471.89,-586 1477.89,-586 1483.89,-592 1483.89,-598 1483.89,-598 1483.89,-610 1483.89,-610 1483.89,-616 1477.89,-622 1471.89,-622"/>
<text text-anchor="middle" x="1392.89" y="-600.9" font-family="Arial" font-size="12.00">スマホアプリ / エッジデバイス</text>
</a>
</g>
</g>
<!-- node_4&#45;&gt;Collector_Service -->
<g id="edge20" class="edge">
<title>node_4&#45;&gt;Collector_Service</title>
<g id="a_edge20"><a xlink:title="POST /api/v1/data&#10;Body:&#10; &#160;user_id: string&#10; &#160;session_id?: string | null&#10; &#160;device_id: string&#10; &#160;timestamp_start_ms: integer&#10; &#160;timestamp_end_ms: integer&#10; &#160;sampling_rate: number&#10; &#160;lsb_to_volts: number&#10; &#160;payload_base64: base64&#45;encoded zstd binary&#10;">
<path fill="none" stroke="black" d="M1484.02,-598C1484.02,-598 1709.13,-598 1709.13,-598"/>
<polygon fill="black" stroke="black" points="1709.13,-601.5 1719.13,-598 1709.13,-594.5 1709.13,-601.5"/>
</a>
</g>
<text text-anchor="middle" x="1699.08" y="-590" font-family="Arial" font-size="10.00">HTTP POST (JSON)</text>
<text text-anchor="middle" x="1699.08" y="-579" font-family="Arial" font-size="10.00">POST /api/v1/data</text>
<text text-anchor="middle" x="1699.08" y="-568" font-family="Arial" font-size="10.00">Body:</text>
<text text-anchor="middle" x="1699.08" y="-557" font-family="Arial" font-size="10.00"> &#160;user_id: string</text>
<text text-anchor="middle" x="1699.08" y="-546" font-family="Arial" font-size="10.00"> &#160;session_id?: string | null</text>
<text text-anchor="middle" x="1699.08" y="-535" font-family="Arial" font-size="10.00"> &#160;device_id: string</text>
<text text-anchor="middle" x="1699.08" y="-524" font-family="Arial" font-size="10.00"> &#160;timestamp_start_ms: integer</text>
<text text-anchor="middle" x="1699.08" y="-513" font-family="Arial" font-size="10.00"> &#160;timestamp_end_ms: integer</text>
<text text-anchor="middle" x="1699.08" y="-502" font-family="Arial" font-size="10.00"> &#160;sampling_rate: number</text>
<text text-anchor="middle" x="1699.08" y="-491" font-family="Arial" font-size="10.00"> &#160;lsb_to_volts: number</text>
<text text-anchor="middle" x="1699.08" y="-480" font-family="Arial" font-size="10.00"> &#160;payload_base64: base64&#45;encoded zstd binary</text>
</g>
<!-- node_4&#45;&gt;Collector_Service -->
<g id="edge21" class="edge">
<title>node_4&#45;&gt;Collector_Service</title>
<g id="a_edge21"><a xlink:title="POST /api/v1/media&#10;Fields:&#10; &#160;file: File&#10; &#160;user_id: string&#10; &#160;session_id: string&#10; &#160;mimetype: string&#10; &#160;original_filename: string&#10; &#160;timestamp_utc?: ISO8601 (image必須)&#10; &#160;start_time_utc?: ISO8601 (audio必須)&#10; &#160;end_time_utc?: ISO8601 (audio必須)&#10;">
<path fill="none" stroke="black" d="M1484.02,-610C1484.02,-610 1709.13,-610 1709.13,-610"/>
<polygon fill="black" stroke="black" points="1709.13,-613.5 1719.13,-610 1709.13,-606.5 1709.13,-613.5"/>
</a>
</g>
<text text-anchor="middle" x="1684.08" y="-723" font-family="Arial" font-size="10.00">HTTP POST (multipart/form&#45;data)</text>
<text text-anchor="middle" x="1684.08" y="-712" font-family="Arial" font-size="10.00">POST /api/v1/media</text>
<text text-anchor="middle" x="1684.08" y="-701" font-family="Arial" font-size="10.00">Fields:</text>
<text text-anchor="middle" x="1684.08" y="-690" font-family="Arial" font-size="10.00"> &#160;file: File</text>
<text text-anchor="middle" x="1684.08" y="-679" font-family="Arial" font-size="10.00"> &#160;user_id: string</text>
<text text-anchor="middle" x="1684.08" y="-668" font-family="Arial" font-size="10.00"> &#160;session_id: string</text>
<text text-anchor="middle" x="1684.08" y="-657" font-family="Arial" font-size="10.00"> &#160;mimetype: string</text>
<text text-anchor="middle" x="1684.08" y="-646" font-family="Arial" font-size="10.00"> &#160;original_filename: string</text>
<text text-anchor="middle" x="1684.08" y="-635" font-family="Arial" font-size="10.00"> &#160;timestamp_utc?: ISO8601 (image必須)</text>
<text text-anchor="middle" x="1684.08" y="-624" font-family="Arial" font-size="10.00"> &#160;start_time_utc?: ISO8601 (audio必須)</text>
<text text-anchor="middle" x="1684.08" y="-613" font-family="Arial" font-size="10.00"> &#160;end_time_utc?: ISO8601 (audio必須)</text>
</g>
<!-- RabbitMQ_exchange_raw_data_exchange&#45;&gt;Processor_Service -->
<g id="edge62" class="edge">
<title>RabbitMQ_exchange_raw_data_exchange&#45;&gt;Processor_Service</title>
<g id="a_edge62"><a xlink:title="Queue: config.PROCESSING_QUEUE (fanout バインド)&#10;Headers:&#10; &#160;user_id: string&#10; &#160;device_id: string&#10; &#160;timestamp_start_ms: integer&#10; &#160;timestamp_end_ms: integer&#10; &#160;sampling_rate: number&#10; &#160;lsb_to_volts: number&#10; &#160;session_id?: string&#10;Body: zstd 圧縮バイナリ (payload format v4)&#10;">
<path fill="none" stroke="black" d="M2231.89,-423.38C2231.89,-548.16 2231.89,-1266 2231.89,-1266 2231.89,-1266 3445.29,-1266 3445.29,-1266"/>
<polygon fill="black" stroke="black" points="3445.29,-1269.5 3455.29,-1266 3445.29,-1262.5 3445.29,-1269.5"/>
</a>
</g>
<text text-anchor="middle" x="2291.78" y="-1258" font-family="Arial" font-size="10.00">AMQP message</text>
<text text-anchor="middle" x="2291.78" y="-1247" font-family="Arial" font-size="10.00">Queue: config.PROCESSING_QUEUE (fanout バインド)</text>
<text text-anchor="middle" x="2291.78" y="-1236" font-family="Arial" font-size="10.00">Headers:</text>
<text text-anchor="middle" x="2291.78" y="-1225" font-family="Arial" font-size="10.00"> &#160;user_id: string</text>
<text text-anchor="middle" x="2291.78" y="-1214" font-family="Arial" font-size="10.00"> &#160;device_id: string</text>
<text text-anchor="middle" x="2291.78" y="-1203" font-family="Arial" font-size="10.00"> &#160;timestamp_start_ms: integer</text>
<text text-anchor="middle" x="2291.78" y="-1192" font-family="Arial" font-size="10.00"> &#160;timestamp_end_ms: integer</text>
<text text-anchor="middle" x="2291.78" y="-1181" font-family="Arial" font-size="10.00"> &#160;sampling_rate: number</text>
<text text-anchor="middle" x="2291.78" y="-1170" font-family="Arial" font-size="10.00"> &#160;lsb_to_volts: number</text>
<text text-anchor="middle" x="2291.78" y="-1159" font-family="Arial" font-size="10.00"> &#160;session_id?: string</text>
<text text-anchor="middle" x="2291.78" y="-1148" font-family="Arial" font-size="10.00">Body: zstd 圧縮バイナリ (payload format v4)</text>
</g>
<!-- Realtime_Analyzer_Service -->
<g id="node39" class="node">
<title>Realtime_Analyzer_Service</title>
<g id="a_node39"><a xlink:title="Realtime Analyzer Service">
<path fill="#ffffff" stroke="black" d="M2694.39,-495C2694.39,-495 2560.39,-495 2560.39,-495 2554.39,-495 2548.39,-489 2548.39,-483 2548.39,-483 2548.39,-471 2548.39,-471 2548.39,-465 2554.39,-459 2560.39,-459 2560.39,-459 2694.39,-459 2694.39,-459 2700.39,-459 2706.39,-465 2706.39,-471 2706.39,-471 2706.39,-483 2706.39,-483 2706.39,-489 2700.39,-495 2694.39,-495"/>
<text text-anchor="middle" x="2627.39" y="-473.9" font-family="Arial" font-size="12.00">Realtime Analyzer Service</text>
</a>
</g>
</g>
<!-- RabbitMQ_exchange_raw_data_exchange&#45;&gt;Realtime_Analyzer_Service -->
<g id="edge76" class="edge">
<title>RabbitMQ_exchange_raw_data_exchange&#45;&gt;Realtime_Analyzer_Service</title>
<g id="a_edge76"><a xlink:title="Queue: analysis_queue (fanout)&#10;Headers:&#10; &#160;user_id: string&#10; &#160;session_id?: string&#10; &#160;sampling_rate: number&#10; &#160;lsb_to_volts: number&#10;Body: zstd 圧縮バイナリ (payload format v4)&#10;">
<path fill="none" stroke="black" d="M2268.89,-423.22C2268.89,-441.83 2268.89,-468 2268.89,-468 2268.89,-468 2538.27,-468 2538.27,-468"/>
<polygon fill="black" stroke="black" points="2538.27,-471.5 2548.27,-468 2538.27,-464.5 2538.27,-471.5"/>
</a>
</g>
<text text-anchor="middle" x="2479.19" y="-460" font-family="Arial" font-size="10.00">AMQP message</text>
<text text-anchor="middle" x="2479.19" y="-449" font-family="Arial" font-size="10.00">Queue: analysis_queue (fanout)</text>
<text text-anchor="middle" x="2479.19" y="-438" font-family="Arial" font-size="10.00">Headers:</text>
<text text-anchor="middle" x="2479.19" y="-427" font-family="Arial" font-size="10.00"> &#160;user_id: string</text>
<text text-anchor="middle" x="2479.19" y="-416" font-family="Arial" font-size="10.00"> &#160;session_id?: string</text>
<text text-anchor="middle" x="2479.19" y="-405" font-family="Arial" font-size="10.00"> &#160;sampling_rate: number</text>
<text text-anchor="middle" x="2479.19" y="-394" font-family="Arial" font-size="10.00"> &#160;lsb_to_volts: number</text>
<text text-anchor="middle" x="2479.19" y="-383" font-family="Arial" font-size="10.00">Body: zstd 圧縮バイナリ (payload format v4)</text>
</g>
<!-- RabbitMQ_queue_media_processing_queue&#45;&gt;Media_Processor_Service -->
<g id="edge43" class="edge">
<title>RabbitMQ_queue_media_processing_queue&#45;&gt;Media_Processor_Service</title>
<g id="a_edge43"><a xlink:title="Headers:&#10; &#160;user_id: string&#10; &#160;session_id: string&#10; &#160;mimetype: string&#10; &#160;original_filename: string&#10; &#160;timestamp_utc?: ISO8601 (image必須)&#10; &#160;start_time_utc?: ISO8601 (audio必須)&#10; &#160;end_time_utc?: ISO8601 (audio必須)&#10;Body: バイナリファイル (画像 or 音声)&#10;">
<path fill="none" stroke="black" d="M2752.01,-839C2982.22,-839 3450.89,-839 3450.89,-839 3450.89,-839 3450.89,-2189.81 3450.89,-2189.81"/>
<polygon fill="black" stroke="black" points="3447.39,-2189.81 3450.89,-2199.81 3454.39,-2189.81 3447.39,-2189.81"/>
</a>
</g>
<text text-anchor="middle" x="3363.39" y="-1156.96" font-family="Arial" font-size="10.00">AMQP message</text>
<text text-anchor="middle" x="3363.39" y="-1145.96" font-family="Arial" font-size="10.00">Headers:</text>
<text text-anchor="middle" x="3363.39" y="-1134.96" font-family="Arial" font-size="10.00"> &#160;user_id: string</text>
<text text-anchor="middle" x="3363.39" y="-1123.96" font-family="Arial" font-size="10.00"> &#160;session_id: string</text>
<text text-anchor="middle" x="3363.39" y="-1112.96" font-family="Arial" font-size="10.00"> &#160;mimetype: string</text>
<text text-anchor="middle" x="3363.39" y="-1101.96" font-family="Arial" font-size="10.00"> &#160;original_filename: string</text>
<text text-anchor="middle" x="3363.39" y="-1090.96" font-family="Arial" font-size="10.00"> &#160;timestamp_utc?: ISO8601 (image必須)</text>
<text text-anchor="middle" x="3363.39" y="-1079.96" font-family="Arial" font-size="10.00"> &#160;start_time_utc?: ISO8601 (audio必須)</text>
<text text-anchor="middle" x="3363.39" y="-1068.96" font-family="Arial" font-size="10.00"> &#160;end_time_utc?: ISO8601 (audio必須)</text>
<text text-anchor="middle" x="3363.39" y="-1057.96" font-family="Arial" font-size="10.00">Body: バイナリファイル (画像 or 音声)</text>
</g>
<!-- DataLinker_Service&#45;&gt;PostgreSQL -->
<g id="edge28" class="edge">
<title>DataLinker_Service&#45;&gt;PostgreSQL</title>
<g id="a_edge28"><a xlink:title="&#45; UPDATE sessions SET link_status, event_correction_status&#10;&#45; UPDATE raw_data_objects SET start_time, end_time, session_id&#10;&#45; INSERT session_object_links(session_id, object_id)&#10;&#45; UPDATE images / audio_clips SET experiment_id&#10;">
<path fill="none" stroke="black" d="M1761.89,-1219.24C1761.89,-1408.9 1761.89,-3014 1761.89,-3014 1761.89,-3014 1444.14,-3014 1444.14,-3014"/>
<polygon fill="black" stroke="black" points="1444.14,-3010.5 1434.14,-3014 1444.14,-3017.5 1444.14,-3010.5"/>
</a>
</g>
<text text-anchor="middle" x="1908.89" y="-2267.49" font-family="Arial" font-size="10.00">SQL UPDATE/INSERT</text>
<text text-anchor="middle" x="1908.89" y="-2256.49" font-family="Arial" font-size="10.00">&#45; UPDATE sessions SET link_status, event_correction_status</text>
<text text-anchor="middle" x="1908.89" y="-2245.49" font-family="Arial" font-size="10.00">&#45; UPDATE raw_data_objects SET start_time, end_time, session_id</text>
<text text-anchor="middle" x="1908.89" y="-2234.49" font-family="Arial" font-size="10.00">&#45; INSERT session_object_links(session_id, object_id)</text>
<text text-anchor="middle" x="1908.89" y="-2223.49" font-family="Arial" font-size="10.00">&#45; UPDATE images / audio_clips SET experiment_id</text>
</g>
<!-- DataLinker_Service&#45;&gt;node_5 -->
<g id="edge30" class="edge">
<title>DataLinker_Service&#45;&gt;node_5</title>
<g id="a_edge30"><a xlink:title="GET /api/v1/health &#45;&gt; { status, rabbitmq_connected, db_connected, queue, timestamp }">
<path fill="none" stroke="black" d="M1833.12,-1207C2258.73,-1207 4814.89,-1207 4814.89,-1207 4814.89,-1207 4814.89,-904.27 4814.89,-904.27"/>
<polygon fill="black" stroke="black" points="4818.39,-904.27 4814.89,-894.27 4811.39,-904.27 4818.39,-904.27"/>
</a>
</g>
<text text-anchor="middle" x="3284.87" y="-1199" font-family="Arial" font-size="10.00">HTTP JSON</text>
<text text-anchor="middle" x="3284.87" y="-1188" font-family="Arial" font-size="10.00">GET /api/v1/health &#45;&gt; { status, rabbitmq_connected, db_connected, queue, timestamp }</text>
</g>
<!-- RabbitMQ_queue_event_correction_queue -->
<g id="node26" class="node">
<title>RabbitMQ_queue_event_correction_queue</title>
<g id="a_node26"><a xlink:title="RabbitMQ queue event_correction_queue">
<path fill="#ffffff" stroke="black" d="M2734.89,-40C2734.89,-40 2519.89,-40 2519.89,-40 2513.89,-40 2507.89,-34 2507.89,-28 2507.89,-28 2507.89,-16 2507.89,-16 2507.89,-10 2513.89,-4 2519.89,-4 2519.89,-4 2734.89,-4 2734.89,-4 2740.89,-4 2746.89,-10 2746.89,-16 2746.89,-16 2746.89,-28 2746.89,-28 2746.89,-34 2740.89,-40 2734.89,-40"/>
<text text-anchor="middle" x="2627.39" y="-18.9" font-family="Arial" font-size="12.00">RabbitMQ queue event_correction_queue</text>
</a>
</g>
</g>
<!-- DataLinker_Service&#45;&gt;RabbitMQ_queue_event_correction_queue -->
<g id="edge29" class="edge">
<title>DataLinker_Service&#45;&gt;RabbitMQ_queue_event_correction_queue</title>
<g id="a_edge29"><a xlink:title="{ session_id: string }&#10;">
<path fill="none" stroke="black" d="M1832.98,-1201C1988.53,-1201 2394.89,-1201 2394.89,-1201 2394.89,-1201 2394.89,-22 2394.89,-22 2394.89,-22 2497.73,-22 2497.73,-22"/>
<polygon fill="black" stroke="black" points="2497.73,-25.5 2507.73,-22 2497.73,-18.5 2497.73,-25.5"/>
</a>
</g>
<text text-anchor="middle" x="2340.39" y="-833.03" font-family="Arial" font-size="10.00">AMQP message (JSON)</text>
<text text-anchor="middle" x="2340.39" y="-822.03" font-family="Arial" font-size="10.00">{ session_id: string }</text>
</g>
<!-- DataLinker_Service&#45;&gt;PostgreSQL_Database -->
<g id="edge58" class="edge">
<title>DataLinker_Service&#45;&gt;PostgreSQL_Database</title>
<g id="a_edge58"><a xlink:title="sessions.link_status, raw_data_objects.start_time/end_time/session_id,&#10;session_object_links, images.experiment_id, audio_clips.experiment_id&#10;">
<path fill="none" stroke="black" d="M1833,-1213C2255.03,-1213 4774.89,-1213 4774.89,-1213 4774.89,-1213 4774.89,-2717 4774.89,-2717"/>
<polygon fill="black" stroke="black" points="4771.39,-2717 4774.89,-2727 4778.39,-2717 4771.39,-2717"/>
</a>
</g>
<text text-anchor="middle" x="3898.94" y="-1205" font-family="Arial" font-size="10.00">SQL UPDATE/INSERT</text>
<text text-anchor="middle" x="3898.94" y="-1194" font-family="Arial" font-size="10.00">sessions.link_status, raw_data_objects.start_time/end_time/session_id,</text>
<text text-anchor="middle" x="3898.94" y="-1183" font-family="Arial" font-size="10.00">session_object_links, images.experiment_id, audio_clips.experiment_id</text>
</g>
<!-- DataLinker_Service&#45;&gt;RabbitMQ -->
<g id="edge69" class="edge">
<title>DataLinker_Service&#45;&gt;RabbitMQ</title>
<g id="a_edge69"><a xlink:title="Queue: event_correction_queue &#45;&gt; { session_id }&#10;">
<path fill="none" stroke="black" d="M1833.07,-1189C1938.09,-1189 2144.89,-1189 2144.89,-1189 2144.89,-1189 2144.89,-1048.09 2144.89,-1048.09"/>
<polygon fill="black" stroke="black" points="2148.39,-1048.09 2144.89,-1038.09 2141.39,-1048.09 2148.39,-1048.09"/>
</a>
</g>
<text text-anchor="middle" x="1953.44" y="-1181" font-family="Arial" font-size="10.00">AMQP sendToQueue</text>
<text text-anchor="middle" x="1953.44" y="-1170" font-family="Arial" font-size="10.00">Queue: event_correction_queue &#45;&gt; { session_id }</text>
</g>
<!-- RabbitMQ_queue_data_linker_queue -->
<g id="node25" class="node">
<title>RabbitMQ_queue_data_linker_queue</title>
<g id="a_node25"><a xlink:title="RabbitMQ queue data_linker_queue">
<path fill="#ffffff" stroke="black" d="M1485.89,-2053C1485.89,-2053 1299.89,-2053 1299.89,-2053 1293.89,-2053 1287.89,-2047 1287.89,-2041 1287.89,-2041 1287.89,-2029 1287.89,-2029 1287.89,-2023 1293.89,-2017 1299.89,-2017 1299.89,-2017 1485.89,-2017 1485.89,-2017 1491.89,-2017 1497.89,-2023 1497.89,-2029 1497.89,-2029 1497.89,-2041 1497.89,-2041 1497.89,-2047 1491.89,-2053 1485.89,-2053"/>
<text text-anchor="middle" x="1392.89" y="-2031.9" font-family="Arial" font-size="12.00">RabbitMQ queue data_linker_queue</text>
</a>
</g>
</g>
<!-- RabbitMQ_queue_data_linker_queue&#45;&gt;DataLinker_Service -->
<g id="edge25" class="edge">
<title>RabbitMQ_queue_data_linker_queue&#45;&gt;DataLinker_Service</title>
<g id="a_edge25"><a xlink:title="{ session_id: string }&#10;">
<path fill="none" stroke="black" d="M1490.89,-2016.81C1490.89,-1894.84 1490.89,-1201 1490.89,-1201 1490.89,-1201 1703.82,-1201 1703.82,-1201"/>
<polygon fill="black" stroke="black" points="1703.82,-1204.5 1713.82,-1201 1703.82,-1197.5 1703.82,-1204.5"/>
</a>
</g>
<text text-anchor="middle" x="1436.39" y="-1494.44" font-family="Arial" font-size="10.00">AMQP message (JSON)</text>
<text text-anchor="middle" x="1436.39" y="-1483.44" font-family="Arial" font-size="10.00">{ session_id: string }</text>
</g>
<!-- RabbitMQ_queue_event_correction_queue&#45;&gt;Event_Corrector_Service -->
<g id="edge37" class="edge">
<title>RabbitMQ_queue_event_correction_queue&#45;&gt;Event_Corrector_Service</title>
<g id="a_edge37"><a xlink:title="{ session_id: string }&#10;">
<path fill="none" stroke="black" d="M2747.08,-22C3148.21,-22 4419.89,-22 4419.89,-22 4419.89,-22 4419.89,-1481.99 4419.89,-1481.99"/>
<polygon fill="black" stroke="black" points="4416.39,-1481.99 4419.89,-1491.99 4423.39,-1481.99 4416.39,-1481.99"/>
</a>
</g>
<text text-anchor="middle" x="4258.98" y="-14" font-family="Arial" font-size="10.00">AMQP message (JSON)</text>
<text text-anchor="middle" x="4258.98" y="-3" font-family="Arial" font-size="10.00">{ session_id: string }</text>
</g>
<!-- Web -->
<g id="node27" class="node">
<title>Web</title>
<g id="a_node27"><a xlink:title="Web / 内部クライアント">
<path fill="#ffffff" stroke="black" d="M4480.39,-4557C4480.39,-4557 4358.39,-4557 4358.39,-4557 4352.39,-4557 4346.39,-4551 4346.39,-4545 4346.39,-4545 4346.39,-4533 4346.39,-4533 4346.39,-4527 4352.39,-4521 4358.39,-4521 4358.39,-4521 4480.39,-4521 4480.39,-4521 4486.39,-4521 4492.39,-4527 4492.39,-4533 4492.39,-4533 4492.39,-4545 4492.39,-4545 4492.39,-4551 4486.39,-4557 4480.39,-4557"/>
<text text-anchor="middle" x="4419.39" y="-4535.9" font-family="Arial" font-size="12.00">Web / 内部クライアント</text>
</a>
</g>
</g>
<!-- Web&#45;&gt;ERP_Neuro_Marketing_Service -->
<g id="edge31" class="edge">
<title>Web&#45;&gt;ERP_Neuro_Marketing_Service</title>
<g id="a_edge31"><a xlink:title="POST /api/v1/neuro&#45;marketing/experiments/:experiment_id/analyze&#10;Headers: X&#45;User&#45;Id (owner 必須)&#10;Body: なし&#10;">
<path fill="none" stroke="black" d="M4419.89,-4520.97C4419.89,-4496.02 4419.89,-4454 4419.89,-4454 4419.89,-4454 4734.68,-4454 4734.68,-4454"/>
<polygon fill="black" stroke="black" points="4734.68,-4457.5 4744.68,-4454 4734.68,-4450.5 4734.68,-4457.5"/>
</a>
</g>
<text text-anchor="middle" x="4397.8" y="-4446" font-family="Arial" font-size="10.00">HTTP POST (JSON)</text>
<text text-anchor="middle" x="4397.8" y="-4435" font-family="Arial" font-size="10.00">POST /api/v1/neuro&#45;marketing/experiments/:experiment_id/analyze</text>
<text text-anchor="middle" x="4397.8" y="-4424" font-family="Arial" font-size="10.00">Headers: X&#45;User&#45;Id (owner 必須)</text>
<text text-anchor="middle" x="4397.8" y="-4413" font-family="Arial" font-size="10.00">Body: なし</text>
</g>
<!-- Event_Corrector_Service&#45;&gt;PostgreSQL -->
<g id="edge41" class="edge">
<title>Event_Corrector_Service&#45;&gt;PostgreSQL</title>
<g id="a_edge41"><a xlink:title="&#45; UPDATE session_events SET onset_corrected_us&#10;&#45; UPDATE sessions SET event_correction_status (&#39;processing&#39;|&#39;completed&#39;|&#39;failed&#39;)&#10;">
<path fill="none" stroke="black" d="M4347.77,-1512.57C4018.85,-1512.57 2668.89,-1512.57 2668.89,-1512.57 2668.89,-1512.57 2668.89,-3026 2668.89,-3026 2668.89,-3026 1443.89,-3026 1443.89,-3026"/>
<polygon fill="black" stroke="black" points="1443.89,-3022.5 1433.89,-3026 1443.89,-3029.5 1443.89,-3022.5"/>
</a>
</g>
<text text-anchor="middle" x="2488.39" y="-2034.34" font-family="Arial" font-size="10.00">SQL UPDATE</text>
<text text-anchor="middle" x="2488.39" y="-2023.34" font-family="Arial" font-size="10.00">&#45; UPDATE session_events SET onset_corrected_us</text>
<text text-anchor="middle" x="2488.39" y="-2012.34" font-family="Arial" font-size="10.00">&#45; UPDATE sessions SET event_correction_status (&#39;processing&#39;|&#39;completed&#39;|&#39;failed&#39;)</text>
</g>
<!-- Event_Corrector_Service&#45;&gt;node_5 -->
<g id="edge42" class="edge">
<title>Event_Corrector_Service&#45;&gt;node_5</title>
<g id="a_edge42"><a xlink:title="GET /api/v1/health &#45;&gt; { status, rabbitmq_connected, db_connected, minio_connected, queue, timestamp }&#10;GET /health &#45;&gt; { status }">
<path fill="none" stroke="black" d="M4490.97,-1504C4614.09,-1504 4852.89,-1504 4852.89,-1504 4852.89,-1504 4852.89,-904.12 4852.89,-904.12"/>
<polygon fill="black" stroke="black" points="4856.39,-904.12 4852.89,-894.12 4849.39,-904.12 4856.39,-904.12"/>
</a>
</g>
<text text-anchor="middle" x="4622.89" y="-1377.02" font-family="Arial" font-size="10.00">HTTP JSON</text>
<text text-anchor="middle" x="4622.89" y="-1366.02" font-family="Arial" font-size="10.00">GET /api/v1/health &#45;&gt; { status, rabbitmq_connected, db_connected, minio_connected, queue, timestamp }</text>
<text text-anchor="middle" x="4622.89" y="-1355.02" font-family="Arial" font-size="10.00">GET /health &#45;&gt; { status }</text>
</g>
<!-- Event_Corrector_Service&#45;&gt;PostgreSQL_Database -->
<g id="edge59" class="edge">
<title>Event_Corrector_Service&#45;&gt;PostgreSQL_Database</title>
<g id="a_edge59"><a xlink:title="session_events.onset_corrected_us,&#10;sessions.event_correction_status&#10;">
<path fill="none" stroke="black" d="M4491.14,-1516C4594.21,-1516 4771.89,-1516 4771.89,-1516 4771.89,-1516 4771.89,-2716.67 4771.89,-2716.67"/>
<polygon fill="black" stroke="black" points="4768.39,-2716.67 4771.89,-2726.67 4775.39,-2716.67 4768.39,-2716.67"/>
</a>
</g>
<text text-anchor="middle" x="4691.89" y="-1967.97" font-family="Arial" font-size="10.00">SQL UPDATE</text>
<text text-anchor="middle" x="4691.89" y="-1956.97" font-family="Arial" font-size="10.00">session_events.onset_corrected_us,</text>
<text text-anchor="middle" x="4691.89" y="-1945.97" font-family="Arial" font-size="10.00">sessions.event_correction_status</text>
</g>
<!-- MinIO_raw_data_bucket -->
<g id="node30" class="node">
<title>MinIO_raw_data_bucket</title>
<g id="a_node30"><a xlink:title="MinIO (raw&#45;data bucket)">
<path fill="#ffffff" stroke="black" d="M4019.89,-1293C4019.89,-1293 3900.89,-1293 3900.89,-1293 3894.89,-1293 3888.89,-1287 3888.89,-1281 3888.89,-1281 3888.89,-1269 3888.89,-1269 3888.89,-1263 3894.89,-1257 3900.89,-1257 3900.89,-1257 4019.89,-1257 4019.89,-1257 4025.89,-1257 4031.89,-1263 4031.89,-1269 4031.89,-1269 4031.89,-1281 4031.89,-1281 4031.89,-1287 4025.89,-1293 4019.89,-1293"/>
<text text-anchor="middle" x="3960.39" y="-1271.9" font-family="Arial" font-size="12.00">MinIO (raw&#45;data bucket)</text>
</a>
</g>
</g>
<!-- MinIO_raw_data_bucket&#45;&gt;Event_Corrector_Service -->
<g id="edge40" class="edge">
<title>MinIO_raw_data_bucket&#45;&gt;Event_Corrector_Service</title>
<g id="a_edge40"><a xlink:title="raw_data_objects.object_id に対応するバイナリ (.bin)&#10;">
<path fill="none" stroke="black" d="M4006.89,-1293.18C4006.89,-1346.23 4006.89,-1497.14 4006.89,-1497.14 4006.89,-1497.14 4337.53,-1497.14 4337.53,-1497.14"/>
<polygon fill="black" stroke="black" points="4337.53,-1500.64 4347.53,-1497.14 4337.53,-1493.64 4337.53,-1500.64"/>
</a>
</g>
<text text-anchor="middle" x="3952.73" y="-1489.14" font-family="Arial" font-size="10.00">Object GET</text>
<text text-anchor="middle" x="3952.73" y="-1478.14" font-family="Arial" font-size="10.00">raw_data_objects.object_id に対応するバイナリ (.bin)</text>
</g>
<!-- Media_Processor_Service&#45;&gt;PostgreSQL -->
<g id="edge46" class="edge">
<title>Media_Processor_Service&#45;&gt;PostgreSQL</title>
<g id="a_edge46"><a xlink:title="&#45; 画像: INSERT INTO images(object_id,user_id,session_id,experiment_id?,timestamp_utc)&#10;&#45; 音声: INSERT INTO audio_clips(object_id,user_id,session_id,experiment_id?,start_time,end_time)&#10;(ON CONFLICT (object_id) DO NOTHING)&#10;">
<path fill="none" stroke="black" d="M3437.11,-2218C3058.45,-2218 1379.89,-2218 1379.89,-2218 1379.89,-2218 1379.89,-2995.65 1379.89,-2995.65"/>
<polygon fill="black" stroke="black" points="1376.39,-2995.65 1379.89,-3005.65 1383.39,-2995.65 1376.39,-2995.65"/>
</a>
</g>
<text text-anchor="middle" x="1802.17" y="-2210" font-family="Arial" font-size="10.00">SQL INSERT</text>
<text text-anchor="middle" x="1802.17" y="-2199" font-family="Arial" font-size="10.00">&#45; 画像: INSERT INTO images(object_id,user_id,session_id,experiment_id?,timestamp_utc)</text>
<text text-anchor="middle" x="1802.17" y="-2188" font-family="Arial" font-size="10.00">&#45; 音声: INSERT INTO audio_clips(object_id,user_id,session_id,experiment_id?,start_time,end_time)</text>
<text text-anchor="middle" x="1802.17" y="-2177" font-family="Arial" font-size="10.00">(ON CONFLICT (object_id) DO NOTHING)</text>
</g>
<!-- Media_Processor_Service&#45;&gt;MinIO -->
<g id="edge49" class="edge">
<title>Media_Processor_Service&#45;&gt;MinIO</title>
<g id="a_edge49"><a xlink:title="Bucket: media&#10;Key: media/{user_id}/{session_id}/{timestampMs}_{photo|audio}{ext}&#10;Metadata: X&#45;User&#45;Id, X&#45;Session&#45;Id, X&#45;Original&#45;Filename&#10;">
<path fill="none" stroke="black" d="M3587.45,-2218C3715.13,-2218 3960.89,-2218 3960.89,-2218 3960.89,-2218 3960.89,-2806.87 3960.89,-2806.87"/>
<polygon fill="black" stroke="black" points="3957.39,-2806.87 3960.89,-2816.87 3964.39,-2806.87 3957.39,-2806.87"/>
</a>
</g>
<text text-anchor="middle" x="3813.39" y="-2317.72" font-family="Arial" font-size="10.00">Object PUT</text>
<text text-anchor="middle" x="3813.39" y="-2306.72" font-family="Arial" font-size="10.00">Bucket: media</text>
<text text-anchor="middle" x="3813.39" y="-2295.72" font-family="Arial" font-size="10.00">Key: media/{user_id}/{session_id}/{timestampMs}_{photo|audio}{ext}</text>
<text text-anchor="middle" x="3813.39" y="-2284.72" font-family="Arial" font-size="10.00">Metadata: X&#45;User&#45;Id, X&#45;Session&#45;Id, X&#45;Original&#45;Filename</text>
</g>
<!-- Media_Processor_Service&#45;&gt;node_5 -->
<g id="edge47" class="edge">
<title>Media_Processor_Service&#45;&gt;node_5</title>
<g id="a_edge47"><a xlink:title="GET /api/v1/health &#45;&gt; { status, rabbitmq_connected, db_connected, minio_connected, last_rabbit_connected_at?, timestamp }&#10;GET /health &#45;&gt; { status }">
<path fill="none" stroke="black" d="M3578.89,-2199.84C3578.89,-2040.05 3578.89,-879.6 3578.89,-879.6 3578.89,-879.6 4766.63,-879.6 4766.63,-879.6"/>
<polygon fill="black" stroke="black" points="4766.63,-883.1 4776.63,-879.6 4766.63,-876.1 4766.63,-883.1"/>
</a>
</g>
<text text-anchor="middle" x="3304.89" y="-937.85" font-family="Arial" font-size="10.00">HTTP JSON</text>
<text text-anchor="middle" x="3304.89" y="-926.85" font-family="Arial" font-size="10.00">GET /api/v1/health &#45;&gt; { status, rabbitmq_connected, db_connected, minio_connected, last_rabbit_connected_at?, timestamp }</text>
<text text-anchor="middle" x="3304.89" y="-915.85" font-family="Arial" font-size="10.00">GET /health &#45;&gt; { status }</text>
</g>
<!-- MinIO_media_bucket -->
<g id="node32" class="node">
<title>MinIO_media_bucket</title>
<g id="a_node32"><a xlink:title="MinIO (media bucket)">
<path fill="#ffffff" stroke="black" d="M4013.39,-3215C4013.39,-3215 3907.39,-3215 3907.39,-3215 3901.39,-3215 3895.39,-3209 3895.39,-3203 3895.39,-3203 3895.39,-3191 3895.39,-3191 3895.39,-3185 3901.39,-3179 3907.39,-3179 3907.39,-3179 4013.39,-3179 4013.39,-3179 4019.39,-3179 4025.39,-3185 4025.39,-3191 4025.39,-3191 4025.39,-3203 4025.39,-3203 4025.39,-3209 4019.39,-3215 4013.39,-3215"/>
<text text-anchor="middle" x="3960.39" y="-3193.9" font-family="Arial" font-size="12.00">MinIO (media bucket)</text>
</a>
</g>
</g>
<!-- Media_Processor_Service&#45;&gt;MinIO_media_bucket -->
<g id="edge45" class="edge">
<title>Media_Processor_Service&#45;&gt;MinIO_media_bucket</title>
<g id="a_edge45"><a xlink:title="Key: media/{user_id}/{session_id}/{timestampMs}_{photo|audio}{extension}&#10;Metadata:&#10; &#160;Content&#45;Type, X&#45;User&#45;Id, X&#45;Session&#45;Id, X&#45;Original&#45;Filename&#10;">
<path fill="none" stroke="black" d="M3587.79,-2227C3705.82,-2227 3920.89,-2227 3920.89,-2227 3920.89,-2227 3920.89,-3168.91 3920.89,-3168.91"/>
<polygon fill="black" stroke="black" points="3917.39,-3168.91 3920.89,-3178.91 3924.39,-3168.91 3917.39,-3168.91"/>
</a>
</g>
<text text-anchor="middle" x="3759.39" y="-2567.41" font-family="Arial" font-size="10.00">Object PUT</text>
<text text-anchor="middle" x="3759.39" y="-2556.41" font-family="Arial" font-size="10.00">Key: media/{user_id}/{session_id}/{timestampMs}_{photo|audio}{extension}</text>
<text text-anchor="middle" x="3759.39" y="-2545.41" font-family="Arial" font-size="10.00">Metadata:</text>
<text text-anchor="middle" x="3759.39" y="-2534.41" font-family="Arial" font-size="10.00"> &#160;Content&#45;Type, X&#45;User&#45;Id, X&#45;Session&#45;Id, X&#45;Original&#45;Filename</text>
</g>
<!-- Media_Processor_Service&#45;&gt;PostgreSQL_Database -->
<g id="edge57" class="edge">
<title>Media_Processor_Service&#45;&gt;PostgreSQL_Database</title>
<g id="a_edge57"><a xlink:title="images(object_id, user_id, session_id, timestamp_utc)&#10;audio_clips(object_id, user_id, session_id, start_time, end_time)&#10;">
<path fill="none" stroke="black" d="M3587.69,-2209C3858.77,-2209 4768.89,-2209 4768.89,-2209 4768.89,-2209 4768.89,-2716.86 4768.89,-2716.86"/>
<polygon fill="black" stroke="black" points="4765.39,-2716.86 4768.89,-2726.86 4772.39,-2716.86 4765.39,-2716.86"/>
</a>
</g>
<text text-anchor="middle" x="4292.22" y="-2201" font-family="Arial" font-size="10.00">SQL INSERT</text>
<text text-anchor="middle" x="4292.22" y="-2190" font-family="Arial" font-size="10.00">images(object_id, user_id, session_id, timestamp_utc)</text>
<text text-anchor="middle" x="4292.22" y="-2179" font-family="Arial" font-size="10.00">audio_clips(object_id, user_id, session_id, start_time, end_time)</text>
</g>
<!-- MinIO_media_bucket&#45;&gt;Session_Manager_Service -->
<g id="edge83" class="edge">
<title>MinIO_media_bucket&#45;&gt;Session_Manager_Service</title>
<g id="a_edge83"><a xlink:title="&#45; カリブレーション刺激: calibration_items.object_id&#10;&#45; 実験刺激: experiment_stimuli.object_id&#10;">
<path fill="none" stroke="black" d="M3895.16,-3208.5C3466.05,-3208.5 1064.89,-3208.5 1064.89,-3208.5 1064.89,-3208.5 1064.89,-3335.86 1064.89,-3335.86"/>
<polygon fill="black" stroke="black" points="1061.39,-3335.86 1064.89,-3345.86 1068.39,-3335.86 1061.39,-3335.86"/>
</a>
</g>
<text text-anchor="middle" x="2303.34" y="-3200.5" font-family="Arial" font-size="10.00">Object GET</text>
<text text-anchor="middle" x="2303.34" y="-3189.5" font-family="Arial" font-size="10.00">&#45; カリブレーション刺激: calibration_items.object_id</text>
<text text-anchor="middle" x="2303.34" y="-3178.5" font-family="Arial" font-size="10.00">&#45; 実験刺激: experiment_stimuli.object_id</text>
</g>
<!-- Processor_Service&#45;&gt;PostgreSQL -->
<g id="edge65" class="edge">
<title>Processor_Service&#45;&gt;PostgreSQL</title>
<g id="a_edge65"><a xlink:title="INSERT raw_data_objects (&#10; &#160;object_id,&#10; &#160;user_id,&#10; &#160;device_id,&#10; &#160;session_id,&#10; &#160;start_time,&#10; &#160;end_time,&#10; &#160;timestamp_start_ms,&#10; &#160;timestamp_end_ms,&#10; &#160;sampling_rate,&#10; &#160;lsb_to_volts&#10;)&#10;ON CONFLICT DO NOTHING&#10;">
<path fill="none" stroke="black" d="M3455.13,-1284C3253.13,-1284 2585.89,-1284 2585.89,-1284 2585.89,-1284 2585.89,-3022 2585.89,-3022 2585.89,-3022 1443.95,-3022 1443.95,-3022"/>
<polygon fill="black" stroke="black" points="1443.95,-3018.5 1433.95,-3022 1443.95,-3025.5 1443.95,-3018.5"/>
</a>
</g>
<text text-anchor="middle" x="2517.89" y="-2281.35" font-family="Arial" font-size="10.00">SQL INSERT</text>
<text text-anchor="middle" x="2517.89" y="-2270.35" font-family="Arial" font-size="10.00">INSERT raw_data_objects (</text>
<text text-anchor="middle" x="2517.89" y="-2259.35" font-family="Arial" font-size="10.00"> &#160;object_id,</text>
<text text-anchor="middle" x="2517.89" y="-2248.35" font-family="Arial" font-size="10.00"> &#160;user_id,</text>
<text text-anchor="middle" x="2517.89" y="-2237.35" font-family="Arial" font-size="10.00"> &#160;device_id,</text>
<text text-anchor="middle" x="2517.89" y="-2226.35" font-family="Arial" font-size="10.00"> &#160;session_id,</text>
<text text-anchor="middle" x="2517.89" y="-2215.35" font-family="Arial" font-size="10.00"> &#160;start_time,</text>
<text text-anchor="middle" x="2517.89" y="-2204.35" font-family="Arial" font-size="10.00"> &#160;end_time,</text>
<text text-anchor="middle" x="2517.89" y="-2193.35" font-family="Arial" font-size="10.00"> &#160;timestamp_start_ms,</text>
<text text-anchor="middle" x="2517.89" y="-2182.35" font-family="Arial" font-size="10.00"> &#160;timestamp_end_ms,</text>
<text text-anchor="middle" x="2517.89" y="-2171.35" font-family="Arial" font-size="10.00"> &#160;sampling_rate,</text>
<text text-anchor="middle" x="2517.89" y="-2160.35" font-family="Arial" font-size="10.00"> &#160;lsb_to_volts</text>
<text text-anchor="middle" x="2517.89" y="-2149.35" font-family="Arial" font-size="10.00">)</text>
<text text-anchor="middle" x="2517.89" y="-2138.35" font-family="Arial" font-size="10.00">ON CONFLICT DO NOTHING</text>
</g>
<!-- Processor_Service&#45;&gt;MinIO -->
<g id="edge48" class="edge">
<title>Processor_Service&#45;&gt;MinIO</title>
<g id="a_edge48"><a xlink:title="Bucket: raw&#45;data&#10;Key: raw/{user_id}/{device_id}/start_ms={timestamp_start_ms}/end_ms={timestamp_end_ms}_{uuid}.bin&#10;Metadata:&#10; &#160;X&#45;User&#45;Id, X&#45;Device&#45;Id, X&#45;Sampling&#45;Rate, X&#45;Lsb&#45;To&#45;Volts, X&#45;Session&#45;Id?&#10;">
<path fill="none" stroke="black" d="M3569.63,-1284C3619.17,-1284 3682.89,-1284 3682.89,-1284 3682.89,-1284 3682.89,-2829 3682.89,-2829 3682.89,-2829 3923.27,-2829 3923.27,-2829"/>
<polygon fill="black" stroke="black" points="3923.27,-2832.5 3933.27,-2829 3923.27,-2825.5 3923.27,-2832.5"/>
</a>
</g>
<text text-anchor="middle" x="3456.39" y="-2112.07" font-family="Arial" font-size="10.00">Object PUT</text>
<text text-anchor="middle" x="3456.39" y="-2101.07" font-family="Arial" font-size="10.00">Bucket: raw&#45;data</text>
<text text-anchor="middle" x="3456.39" y="-2090.07" font-family="Arial" font-size="10.00">Key: raw/{user_id}/{device_id}/start_ms={timestamp_start_ms}/end_ms={timestamp_end_ms}_{uuid}.bin</text>
<text text-anchor="middle" x="3456.39" y="-2079.07" font-family="Arial" font-size="10.00">Metadata:</text>
<text text-anchor="middle" x="3456.39" y="-2068.07" font-family="Arial" font-size="10.00"> &#160;X&#45;User&#45;Id, X&#45;Device&#45;Id, X&#45;Sampling&#45;Rate, X&#45;Lsb&#45;To&#45;Volts, X&#45;Session&#45;Id?</text>
</g>
<!-- Processor_Service&#45;&gt;node_5 -->
<g id="edge66" class="edge">
<title>Processor_Service&#45;&gt;node_5</title>
<g id="a_edge66"><a xlink:title="GET /api/v1/health &#45;&gt; { status, rabbitmq_connected, db_connected, last_rabbit_connected_at?, timestamp }&#10;GET /health &#45;&gt; { status }">
<path fill="none" stroke="black" d="M3512.89,-1256.92C3512.89,-1178.58 3512.89,-872.4 3512.89,-872.4 3512.89,-872.4 4766.64,-872.4 4766.64,-872.4"/>
<polygon fill="black" stroke="black" points="4766.64,-875.9 4776.64,-872.4 4766.64,-868.9 4766.64,-875.9"/>
</a>
</g>
<text text-anchor="middle" x="3713.01" y="-864.4" font-family="Arial" font-size="10.00">HTTP JSON</text>
<text text-anchor="middle" x="3713.01" y="-853.4" font-family="Arial" font-size="10.00">GET /api/v1/health &#45;&gt; { status, rabbitmq_connected, db_connected, last_rabbit_connected_at?, timestamp }</text>
<text text-anchor="middle" x="3713.01" y="-842.4" font-family="Arial" font-size="10.00">GET /health &#45;&gt; { status }</text>
</g>
<!-- Processor_Service&#45;&gt;MinIO_raw_data_bucket -->
<g id="edge64" class="edge">
<title>Processor_Service&#45;&gt;MinIO_raw_data_bucket</title>
<g id="a_edge64"><a xlink:title="Key: raw/{user_id}/{device_id}/start_ms={timestamp_start_ms}/end_ms={timestamp_end_ms}_{uuid}.bin&#10;Metadata:&#10; &#160;Content&#45;Type: application/octet&#45;stream&#10; &#160;X&#45;User&#45;Id, X&#45;Device&#45;Id, X&#45;Sampling&#45;Rate, X&#45;Lsb&#45;To&#45;Volts, X&#45;Session&#45;Id?&#10;">
<path fill="none" stroke="black" d="M3569.58,-1266C3569.58,-1266 3878.75,-1266 3878.75,-1266"/>
<polygon fill="black" stroke="black" points="3878.75,-1269.5 3888.75,-1266 3878.75,-1262.5 3878.75,-1269.5"/>
</a>
</g>
<text text-anchor="middle" x="3497.67" y="-1258" font-family="Arial" font-size="10.00">Object PUT</text>
<text text-anchor="middle" x="3497.67" y="-1247" font-family="Arial" font-size="10.00">Key: raw/{user_id}/{device_id}/start_ms={timestamp_start_ms}/end_ms={timestamp_end_ms}_{uuid}.bin</text>
<text text-anchor="middle" x="3497.67" y="-1236" font-family="Arial" font-size="10.00">Metadata:</text>
<text text-anchor="middle" x="3497.67" y="-1225" font-family="Arial" font-size="10.00"> &#160;Content&#45;Type: application/octet&#45;stream</text>
<text text-anchor="middle" x="3497.67" y="-1214" font-family="Arial" font-size="10.00"> &#160;X&#45;User&#45;Id, X&#45;Device&#45;Id, X&#45;Sampling&#45;Rate, X&#45;Lsb&#45;To&#45;Volts, X&#45;Session&#45;Id?</text>
</g>
<!-- Processor_Service&#45;&gt;PostgreSQL_Database -->
<g id="edge56" class="edge">
<title>Processor_Service&#45;&gt;PostgreSQL_Database</title>
<g id="a_edge56"><a xlink:title="raw_data_objects(object_id, user_id, device_id, session_id?, start_time?, end_time?, timestamp_start_ms, timestamp_end_ms, sampling_rate, lsb_to_volts)&#10;">
<path fill="none" stroke="black" d="M3569.55,-1275C3641.24,-1275 3754.89,-1275 3754.89,-1275 3754.89,-1275 3754.89,-2741 3754.89,-2741 3754.89,-2741 4755.1,-2741 4755.1,-2741"/>
<polygon fill="black" stroke="black" points="4755.1,-2744.5 4765.1,-2741 4755.1,-2737.5 4755.1,-2744.5"/>
</a>
</g>
<text text-anchor="middle" x="3413.89" y="-2407.44" font-family="Arial" font-size="10.00">SQL INSERT</text>
<text text-anchor="middle" x="3413.89" y="-2396.44" font-family="Arial" font-size="10.00">raw_data_objects(object_id, user_id, device_id, session_id?, start_time?, end_time?, timestamp_start_ms, timestamp_end_ms, sampling_rate, lsb_to_volts)</text>
</g>
<!-- Stimulus_Asset_Processor_Service&#45;&gt;PostgreSQL -->
<g id="edge92" class="edge">
<title>Stimulus_Asset_Processor_Service&#45;&gt;PostgreSQL</title>
<g id="a_edge92"><a xlink:title="INSERT INTO experiment_stimuli (&#10; &#160;experiment_id,&#10; &#160;file_name,&#10; &#160;stimulus_type,&#10; &#160;trial_type,&#10; &#160;description,&#10; &#160;object_id&#10;)&#10;ON CONFLICT (experiment_id, file_name)&#10;DO UPDATE SET stimulus_type, trial_type, description, object_id&#10;">
<path fill="none" stroke="black" d="M3413.66,-2704C2997.39,-2704 1406.89,-2704 1406.89,-2704 1406.89,-2704 1406.89,-2995.88 1406.89,-2995.88"/>
<polygon fill="black" stroke="black" points="1403.39,-2995.88 1406.89,-3005.88 1410.39,-2995.88 1403.39,-2995.88"/>
</a>
</g>
<text text-anchor="middle" x="2119.83" y="-2696" font-family="Arial" font-size="10.00">SQL UPSERT</text>
<text text-anchor="middle" x="2119.83" y="-2685" font-family="Arial" font-size="10.00">INSERT INTO experiment_stimuli (</text>
<text text-anchor="middle" x="2119.83" y="-2674" font-family="Arial" font-size="10.00"> &#160;experiment_id,</text>
<text text-anchor="middle" x="2119.83" y="-2663" font-family="Arial" font-size="10.00"> &#160;file_name,</text>
<text text-anchor="middle" x="2119.83" y="-2652" font-family="Arial" font-size="10.00"> &#160;stimulus_type,</text>
<text text-anchor="middle" x="2119.83" y="-2641" font-family="Arial" font-size="10.00"> &#160;trial_type,</text>
<text text-anchor="middle" x="2119.83" y="-2630" font-family="Arial" font-size="10.00"> &#160;description,</text>
<text text-anchor="middle" x="2119.83" y="-2619" font-family="Arial" font-size="10.00"> &#160;object_id</text>
<text text-anchor="middle" x="2119.83" y="-2608" font-family="Arial" font-size="10.00">)</text>
<text text-anchor="middle" x="2119.83" y="-2597" font-family="Arial" font-size="10.00">ON CONFLICT (experiment_id, file_name)</text>
<text text-anchor="middle" x="2119.83" y="-2586" font-family="Arial" font-size="10.00">DO UPDATE SET stimulus_type, trial_type, description, object_id</text>
</g>
<!-- Stimulus_Asset_Processor_Service&#45;&gt;MinIO -->
<g id="edge50" class="edge">
<title>Stimulus_Asset_Processor_Service&#45;&gt;MinIO</title>
<g id="a_edge50"><a xlink:title="Bucket: media&#10;Key: stimuli/{experiment_id}/{file_name}&#10;Metadata: Content&#45;Type from MIME&#10;">
<path fill="none" stroke="black" d="M3610.98,-2701C3739.18,-2701 3946.89,-2701 3946.89,-2701 3946.89,-2701 3946.89,-2806.93 3946.89,-2806.93"/>
<polygon fill="black" stroke="black" points="3943.39,-2806.93 3946.89,-2816.93 3950.39,-2806.93 3943.39,-2806.93"/>
</a>
</g>
<text text-anchor="middle" x="3745.4" y="-2693" font-family="Arial" font-size="10.00">Object PUT</text>
<text text-anchor="middle" x="3745.4" y="-2682" font-family="Arial" font-size="10.00">Bucket: media</text>
<text text-anchor="middle" x="3745.4" y="-2671" font-family="Arial" font-size="10.00">Key: stimuli/{experiment_id}/{file_name}</text>
<text text-anchor="middle" x="3745.4" y="-2660" font-family="Arial" font-size="10.00">Metadata: Content&#45;Type from MIME</text>
</g>
<!-- Stimulus_Asset_Processor_Service&#45;&gt;node_5 -->
<g id="edge93" class="edge">
<title>Stimulus_Asset_Processor_Service&#45;&gt;node_5</title>
<g id="a_edge93"><a xlink:title="GET /api/v1/health &#45;&gt; { status, rabbitmq_connected, db_connected, minio_connected, queue, last_rabbit_connected_at?, timestamp }&#10;GET /health &#45;&gt; { status }">
<path fill="none" stroke="black" d="M3599.89,-2688.98C3599.89,-2499.94 3599.89,-886.8 3599.89,-886.8 3599.89,-886.8 4766.77,-886.8 4766.77,-886.8"/>
<polygon fill="black" stroke="black" points="4766.77,-890.3 4776.77,-886.8 4766.77,-883.3 4766.77,-890.3"/>
</a>
</g>
<text text-anchor="middle" x="3889.89" y="-1229.45" font-family="Arial" font-size="10.00">HTTP JSON</text>
<text text-anchor="middle" x="3889.89" y="-1218.45" font-family="Arial" font-size="10.00">GET /api/v1/health &#45;&gt; { status, rabbitmq_connected, db_connected, minio_connected, queue, last_rabbit_connected_at?, timestamp }</text>
<text text-anchor="middle" x="3889.89" y="-1207.45" font-family="Arial" font-size="10.00">GET /health &#45;&gt; { status }</text>
</g>
<!-- Stimulus_Asset_Processor_Service&#45;&gt;MinIO_media_bucket -->
<g id="edge91" class="edge">
<title>Stimulus_Asset_Processor_Service&#45;&gt;MinIO_media_bucket</title>
<g id="a_edge91"><a xlink:title="Key: stimuli/{experiment_id}/{fileName}&#10;Metadata: Content&#45;Type = mimeType&#10;">
<path fill="none" stroke="black" d="M3610.91,-2713C3728.33,-2713 3908.89,-2713 3908.89,-2713 3908.89,-2713 3908.89,-3168.91 3908.89,-3168.91"/>
<polygon fill="black" stroke="black" points="3905.39,-3168.91 3908.89,-3178.91 3912.39,-3168.91 3905.39,-3168.91"/>
</a>
</g>
<text text-anchor="middle" x="3823.89" y="-2783.97" font-family="Arial" font-size="10.00">Object PUT</text>
<text text-anchor="middle" x="3823.89" y="-2772.97" font-family="Arial" font-size="10.00">Key: stimuli/{experiment_id}/{fileName}</text>
<text text-anchor="middle" x="3823.89" y="-2761.97" font-family="Arial" font-size="10.00">Metadata: Content&#45;Type = mimeType</text>
</g>
<!-- BIDS_Exporter_ERP_Neuro_Marketing&#45;&gt;PostgreSQL_Database -->
<g id="edge60" class="edge">
<title>BIDS_Exporter_ERP_Neuro_Marketing&#45;&gt;PostgreSQL_Database</title>
<g id="a_edge60"><a xlink:title="&#45; export_tasks&#10;&#45; erp_analysis_results (将来的な利用)&#10;">
<path fill="none" stroke="black" d="M4509.89,-2816.93C4509.89,-2794.83 4509.89,-2760.33 4509.89,-2760.33 4509.89,-2760.33 4755.17,-2760.33 4755.17,-2760.33"/>
<polygon fill="black" stroke="black" points="4755.17,-2763.83 4765.17,-2760.33 4755.17,-2756.83 4755.17,-2763.83"/>
</a>
</g>
<text text-anchor="middle" x="4522.73" y="-2752.33" font-family="Arial" font-size="10.00">SQL SELECT/INSERT</text>
<text text-anchor="middle" x="4522.73" y="-2741.33" font-family="Arial" font-size="10.00">&#45; export_tasks</text>
<text text-anchor="middle" x="4522.73" y="-2730.33" font-family="Arial" font-size="10.00">&#45; erp_analysis_results (将来的な利用)</text>
</g>
<!-- node_7 -->
<g id="node37" class="node">
<title>node_7</title>
<g id="a_node37"><a xlink:title="全アプリケーション">
<path fill="#ffffff" stroke="black" d="M5250.89,-2763C5250.89,-2763 5149.89,-2763 5149.89,-2763 5143.89,-2763 5137.89,-2757 5137.89,-2751 5137.89,-2751 5137.89,-2739 5137.89,-2739 5137.89,-2733 5143.89,-2727 5149.89,-2727 5149.89,-2727 5250.89,-2727 5250.89,-2727 5256.89,-2727 5262.89,-2733 5262.89,-2739 5262.89,-2739 5262.89,-2751 5262.89,-2751 5262.89,-2757 5256.89,-2763 5250.89,-2763"/>
<text text-anchor="middle" x="5200.39" y="-2741.9" font-family="Arial" font-size="12.00">全アプリケーション</text>
</a>
</g>
</g>
<!-- PostgreSQL_Database&#45;&gt;node_7 -->
<g id="edge61" class="edge">
<title>PostgreSQL_Database&#45;&gt;node_7</title>
<g id="a_edge61"><a xlink:title="各種読み取りクエリ (実験一覧、刺激メタデータ、解析対象など)">
<path fill="none" stroke="black" d="M4901.55,-2745C4901.55,-2745 5127.78,-2745 5127.78,-2745"/>
<polygon fill="black" stroke="black" points="5127.78,-2748.5 5137.78,-2745 5127.78,-2741.5 5127.78,-2748.5"/>
</a>
</g>
<text text-anchor="middle" x="5156.17" y="-2737" font-family="Arial" font-size="10.00">SQL SELECT</text>
<text text-anchor="middle" x="5156.17" y="-2726" font-family="Arial" font-size="10.00">各種読み取りクエリ (実験一覧、刺激メタデータ、解析対象など)</text>
</g>
<!-- RabbitMQ&#45;&gt;DataLinker_Service -->
<g id="edge74" class="edge">
<title>RabbitMQ&#45;&gt;DataLinker_Service</title>
<g id="a_edge74"><a xlink:title="Queue: data_linker_queue&#10;">
<path fill="none" stroke="black" d="M2156.89,-1038.07C2156.89,-1082.78 2156.89,-1195 2156.89,-1195 2156.89,-1195 1842.89,-1195 1842.89,-1195"/>
<polygon fill="black" stroke="black" points="1842.89,-1191.5 1832.89,-1195 1842.89,-1198.5 1842.89,-1191.5"/>
</a>
</g>
<text text-anchor="middle" x="2021.35" y="-1209" font-family="Arial" font-size="10.00">AMQP consume</text>
<text text-anchor="middle" x="2021.35" y="-1198" font-family="Arial" font-size="10.00">Queue: data_linker_queue</text>
</g>
<!-- RabbitMQ&#45;&gt;Event_Corrector_Service -->
<g id="edge75" class="edge">
<title>RabbitMQ&#45;&gt;Event_Corrector_Service</title>
<g id="a_edge75"><a xlink:title="Queue: event_correction_queue">
<path fill="none" stroke="black" d="M2179.89,-1038.03C2179.89,-1125.58 2179.89,-1502.29 2179.89,-1502.29 2179.89,-1502.29 4337.72,-1502.29 4337.72,-1502.29"/>
<polygon fill="black" stroke="black" points="4337.72,-1505.79 4347.72,-1502.29 4337.72,-1498.79 4337.72,-1505.79"/>
</a>
</g>
<text text-anchor="middle" x="2957.17" y="-1494.29" font-family="Arial" font-size="10.00">AMQP consume</text>
<text text-anchor="middle" x="2957.17" y="-1483.29" font-family="Arial" font-size="10.00">Queue: event_correction_queue</text>
</g>
<!-- RabbitMQ&#45;&gt;Media_Processor_Service -->
<g id="edge72" class="edge">
<title>RabbitMQ&#45;&gt;Media_Processor_Service</title>
<g id="a_edge72"><a xlink:title="Queue: media_processing_queue&#10;">
<path fill="none" stroke="black" d="M2203.43,-1020C2410,-1020 3446.89,-1020 3446.89,-1020 3446.89,-1020 3446.89,-2189.66 3446.89,-2189.66"/>
<polygon fill="black" stroke="black" points="3443.39,-2189.66 3446.89,-2199.66 3450.39,-2189.66 3443.39,-2189.66"/>
</a>
</g>
<text text-anchor="middle" x="3337.49" y="-1012" font-family="Arial" font-size="10.00">AMQP consume</text>
<text text-anchor="middle" x="3337.49" y="-1001" font-family="Arial" font-size="10.00">Queue: media_processing_queue</text>
</g>
<!-- RabbitMQ&#45;&gt;Processor_Service -->
<g id="edge70" class="edge">
<title>RabbitMQ&#45;&gt;Processor_Service</title>
<g id="a_edge70"><a xlink:title="Queue: processing_queue (raw_data_exchange fanout)&#10;">
<path fill="none" stroke="black" d="M2191.89,-1038.34C2191.89,-1096.81 2191.89,-1275 2191.89,-1275 2191.89,-1275 3445.22,-1275 3445.22,-1275"/>
<polygon fill="black" stroke="black" points="3445.22,-1278.5 3455.22,-1275 3445.22,-1271.5 3445.22,-1278.5"/>
</a>
</g>
<text text-anchor="middle" x="2580.22" y="-1267" font-family="Arial" font-size="10.00">AMQP consume</text>
<text text-anchor="middle" x="2580.22" y="-1256" font-family="Arial" font-size="10.00">Queue: processing_queue (raw_data_exchange fanout)</text>
</g>
<!-- RabbitMQ&#45;&gt;Stimulus_Asset_Processor_Service -->
<g id="edge73" class="edge">
<title>RabbitMQ&#45;&gt;Stimulus_Asset_Processor_Service</title>
<g id="a_edge73"><a xlink:title="Queue: stimulus_asset_queue&#10;">
<path fill="none" stroke="black" d="M2203.68,-1029C2409.38,-1029 3431.89,-1029 3431.89,-1029 3431.89,-1029 3431.89,-2678.73 3431.89,-2678.73"/>
<polygon fill="black" stroke="black" points="3428.39,-2678.73 3431.89,-2688.73 3435.39,-2678.73 3428.39,-2678.73"/>
</a>
</g>
<text text-anchor="middle" x="3365.39" y="-1231.76" font-family="Arial" font-size="10.00">AMQP consume</text>
<text text-anchor="middle" x="3365.39" y="-1220.76" font-family="Arial" font-size="10.00">Queue: stimulus_asset_queue</text>
</g>
<!-- RabbitMQ&#45;&gt;Realtime_Analyzer_Service -->
<g id="edge71" class="edge">
<title>RabbitMQ&#45;&gt;Realtime_Analyzer_Service</title>
<g id="a_edge71"><a xlink:title="Queue: analysis_queue (raw_data_exchange fanout)&#10;">
<path fill="none" stroke="black" d="M2203.61,-1011C2225.71,-1011 2249.89,-1011 2249.89,-1011 2249.89,-1011 2249.89,-486 2249.89,-486 2249.89,-486 2538.25,-486 2538.25,-486"/>
<polygon fill="black" stroke="black" points="2538.25,-489.5 2548.25,-486 2538.25,-482.5 2538.25,-489.5"/>
</a>
</g>
<text text-anchor="middle" x="2364.39" y="-619.45" font-family="Arial" font-size="10.00">AMQP consume</text>
<text text-anchor="middle" x="2364.39" y="-608.45" font-family="Arial" font-size="10.00">Queue: analysis_queue (raw_data_exchange fanout)</text>
</g>
<!-- Realtime_Analyzer_Service&#45;&gt;HTTP -->
<g id="edge78" class="edge">
<title>Realtime_Analyzer_Service&#45;&gt;HTTP</title>
<g id="a_edge78"><a xlink:title="GET /api/v1/users/{user_id}/analysis &#45;&gt;&#10; &#160;{&#10; &#160;&#160;&#160;&quot;spectral_psd_png_base64&quot;: string,&#10; &#160;&#160;&#160;&quot;connectivity_png_base64&quot;: string,&#10; &#160;&#160;&#160;&quot;channel_quality&quot;: {&#10; &#160;&#160;&#160;&#160;&#160;channel_name: {&#10; &#160;&#160;&#160;&#160;&#160;&#160;&#160;status: &#39;good&#39;|&#39;bad&#39;,&#10; &#160;&#160;&#160;&#160;&#160;&#160;&#160;reasons: string[],&#10; &#160;&#160;&#160;&#160;&#160;&#160;&#160;zero_ratio: number,&#10; &#160;&#160;&#160;&#160;&#160;&#160;&#160;bad_impedance_ratio: number,&#10; &#160;&#160;&#160;&#160;&#160;&#160;&#160;unknown_impedance_ratio: number,&#10; &#160;&#160;&#160;&#160;&#160;&#160;&#160;flatline: boolean,&#10; &#160;&#160;&#160;&#160;&#160;&#160;&#160;type: string,&#10; &#160;&#160;&#160;&#160;&#160;&#160;&#160;has_warning: boolean&#10; &#160;&#160;&#160;&#160;&#160;}&#10; &#160;&#160;&#160;},&#10; &#160;&#160;&#160;&quot;generated_at&quot;: ISO8601&#10; &#160;}&#10;データ未準備時は 202 + {status: &quot;...&quot;}&#10;">
<path fill="none" stroke="black" d="M2706.5,-483C2832.06,-483 3062.89,-483 3062.89,-483 3062.89,-483 3062.89,-2008.74 3062.89,-2008.74"/>
<polygon fill="black" stroke="black" points="3059.39,-2008.74 3062.89,-2018.74 3066.39,-2008.74 3059.39,-2008.74"/>
</a>
</g>
<text text-anchor="middle" x="2972.39" y="-1279.68" font-family="Arial" font-size="10.00">JSON</text>
<text text-anchor="middle" x="2972.39" y="-1268.68" font-family="Arial" font-size="10.00">GET /api/v1/users/{user_id}/analysis &#45;&gt;</text>
<text text-anchor="middle" x="2972.39" y="-1257.68" font-family="Arial" font-size="10.00"> &#160;{</text>
<text text-anchor="middle" x="2972.39" y="-1246.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&quot;spectral_psd_png_base64&quot;: string,</text>
<text text-anchor="middle" x="2972.39" y="-1235.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&quot;connectivity_png_base64&quot;: string,</text>
<text text-anchor="middle" x="2972.39" y="-1224.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&quot;channel_quality&quot;: {</text>
<text text-anchor="middle" x="2972.39" y="-1213.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;channel_name: {</text>
<text text-anchor="middle" x="2972.39" y="-1202.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;status: &#39;good&#39;|&#39;bad&#39;,</text>
<text text-anchor="middle" x="2972.39" y="-1191.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;reasons: string[],</text>
<text text-anchor="middle" x="2972.39" y="-1180.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;zero_ratio: number,</text>
<text text-anchor="middle" x="2972.39" y="-1169.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;bad_impedance_ratio: number,</text>
<text text-anchor="middle" x="2972.39" y="-1158.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;unknown_impedance_ratio: number,</text>
<text text-anchor="middle" x="2972.39" y="-1147.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;flatline: boolean,</text>
<text text-anchor="middle" x="2972.39" y="-1136.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;type: string,</text>
<text text-anchor="middle" x="2972.39" y="-1125.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;has_warning: boolean</text>
<text text-anchor="middle" x="2972.39" y="-1114.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&#160;&#160;}</text>
<text text-anchor="middle" x="2972.39" y="-1103.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;},</text>
<text text-anchor="middle" x="2972.39" y="-1092.68" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;&quot;generated_at&quot;: ISO8601</text>
<text text-anchor="middle" x="2972.39" y="-1081.68" font-family="Arial" font-size="10.00"> &#160;}</text>
<text text-anchor="middle" x="2972.39" y="-1070.68" font-family="Arial" font-size="10.00">データ未準備時は 202 + {status: &quot;...&quot;}</text>
</g>
<!-- Realtime_Analyzer_Service&#45;&gt;node_5 -->
<g id="edge79" class="edge">
<title>Realtime_Analyzer_Service&#45;&gt;node_5</title>
<g id="a_edge79"><a xlink:title="GET /health &#45;&gt; {status:&#39;ok&#39;|&#39;unhealthy&#39;}">
<path fill="none" stroke="black" d="M2706.57,-471C3100.89,-471 4833.89,-471 4833.89,-471 4833.89,-471 4833.89,-847.81 4833.89,-847.81"/>
<polygon fill="black" stroke="black" points="4830.39,-847.81 4833.89,-857.81 4837.39,-847.81 4830.39,-847.81"/>
</a>
</g>
<text text-anchor="middle" x="3874.63" y="-463" font-family="Arial" font-size="10.00">JSON</text>
<text text-anchor="middle" x="3874.63" y="-452" font-family="Arial" font-size="10.00">GET /health &#45;&gt; {status:&#39;ok&#39;|&#39;unhealthy&#39;}</text>
</g>
<!-- Configuration -->
<g id="node40" class="node">
<title>Configuration</title>
<g id="a_node40"><a xlink:title="Configuration">
<path fill="#ffffff" stroke="black" d="M2200.39,-567C2200.39,-567 2135.39,-567 2135.39,-567 2129.39,-567 2123.39,-561 2123.39,-555 2123.39,-555 2123.39,-543 2123.39,-543 2123.39,-537 2129.39,-531 2135.39,-531 2135.39,-531 2200.39,-531 2200.39,-531 2206.39,-531 2212.39,-537 2212.39,-543 2212.39,-543 2212.39,-555 2212.39,-555 2212.39,-561 2206.39,-567 2200.39,-567"/>
<text text-anchor="middle" x="2167.89" y="-545.9" font-family="Arial" font-size="12.00">Configuration</text>
</a>
</g>
</g>
<!-- Configuration&#45;&gt;Realtime_Analyzer_Service -->
<g id="edge77" class="edge">
<title>Configuration&#45;&gt;Realtime_Analyzer_Service</title>
<g id="a_edge77"><a xlink:title="SAMPLE_RATE, ANALYSIS_WINDOW_SEC, ANALYSIS_INTERVAL_SECONDS など解析パラメータ&#10;">
<path fill="none" stroke="black" d="M2167.89,-530.83C2167.89,-509.5 2167.89,-477 2167.89,-477 2167.89,-477 2538.13,-477 2538.13,-477"/>
<polygon fill="black" stroke="black" points="2538.13,-480.5 2548.13,-477 2538.13,-473.5 2538.13,-480.5"/>
</a>
</g>
<text text-anchor="middle" x="2097.59" y="-469" font-family="Arial" font-size="10.00">env</text>
<text text-anchor="middle" x="2097.59" y="-458" font-family="Arial" font-size="10.00">SAMPLE_RATE, ANALYSIS_WINDOW_SEC, ANALYSIS_INTERVAL_SECONDS など解析パラメータ</text>
</g>
<!-- Web_2 -->
<g id="node41" class="node">
<title>Web_2</title>
<g id="a_node41"><a xlink:title="クライアント (スマホアプリ / Web)">
<path fill="#ffffff" stroke="black" d="M685.89,-3238C685.89,-3238 504.89,-3238 504.89,-3238 498.89,-3238 492.89,-3232 492.89,-3226 492.89,-3226 492.89,-3214 492.89,-3214 492.89,-3208 498.89,-3202 504.89,-3202 504.89,-3202 685.89,-3202 685.89,-3202 691.89,-3202 697.89,-3208 697.89,-3214 697.89,-3214 697.89,-3226 697.89,-3226 697.89,-3232 691.89,-3238 685.89,-3238"/>
<text text-anchor="middle" x="595.39" y="-3216.9" font-family="Arial" font-size="12.00">クライアント (スマホアプリ / Web)</text>
</a>
</g>
</g>
<!-- Web_2&#45;&gt;Session_Manager_Service -->
<g id="edge80" class="edge">
<title>Web_2&#45;&gt;Session_Manager_Service</title>
<g id="a_edge80"><a xlink:title="&#45; POST /api/v1/experiments&#10; &#160;Body (JSON): { name: string, description?: string, password?: string(min:4), presentation_order?: &#39;sequential&#39;|&#39;random&#39; }&#10;&#45; POST /api/v1/sessions/end&#10; &#160;Body (multipart):&#10; &#160;&#160;&#160;metadata: JSON (session_end_metadata)&#10; &#160;&#160;&#160;events_log_csv?: CSV (列: onset,duration,trial_type,file_name?,description?,value?)&#10;">
<path fill="none" stroke="black" d="M698.11,-3233C794.15,-3233 922.89,-3233 922.89,-3233 922.89,-3233 922.89,-3335.79 922.89,-3335.79"/>
<polygon fill="black" stroke="black" points="919.39,-3335.78 922.89,-3345.79 926.39,-3335.79 919.39,-3335.78"/>
</a>
</g>
<text text-anchor="middle" x="1123.89" y="-3225" font-family="Arial" font-size="10.00">HTTP JSON / multipart/form&#45;data</text>
<text text-anchor="middle" x="1123.89" y="-3214" font-family="Arial" font-size="10.00">&#45; POST /api/v1/experiments</text>
<text text-anchor="middle" x="1123.89" y="-3203" font-family="Arial" font-size="10.00"> &#160;Body (JSON): { name: string, description?: string, password?: string(min:4), presentation_order?: &#39;sequential&#39;|&#39;random&#39; }</text>
<text text-anchor="middle" x="1123.89" y="-3192" font-family="Arial" font-size="10.00">&#45; POST /api/v1/sessions/end</text>
<text text-anchor="middle" x="1123.89" y="-3181" font-family="Arial" font-size="10.00"> &#160;Body (multipart):</text>
<text text-anchor="middle" x="1123.89" y="-3170" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;metadata: JSON (session_end_metadata)</text>
<text text-anchor="middle" x="1123.89" y="-3159" font-family="Arial" font-size="10.00"> &#160;&#160;&#160;events_log_csv?: CSV (列: onset,duration,trial_type,file_name?,description?,value?)</text>
</g>
<!-- RabbitMQ_queue_stimulus_asset_queue -->
<g id="node45" class="node">
<title>RabbitMQ_queue_stimulus_asset_queue</title>
<g id="a_node45"><a xlink:title="RabbitMQ queue stimulus_asset_queue">
<path fill="#ffffff" stroke="black" d="M3185.89,-2635C3185.89,-2635 2979.89,-2635 2979.89,-2635 2973.89,-2635 2967.89,-2629 2967.89,-2623 2967.89,-2623 2967.89,-2611 2967.89,-2611 2967.89,-2605 2973.89,-2599 2979.89,-2599 2979.89,-2599 3185.89,-2599 3185.89,-2599 3191.89,-2599 3197.89,-2605 3197.89,-2611 3197.89,-2611 3197.89,-2623 3197.89,-2623 3197.89,-2629 3191.89,-2635 3185.89,-2635"/>
<text text-anchor="middle" x="3082.89" y="-2613.9" font-family="Arial" font-size="12.00">RabbitMQ queue stimulus_asset_queue</text>
</a>
</g>
</g>
<!-- RabbitMQ_queue_stimulus_asset_queue&#45;&gt;Stimulus_Asset_Processor_Service -->
<g id="edge89" class="edge">
<title>RabbitMQ_queue_stimulus_asset_queue&#45;&gt;Stimulus_Asset_Processor_Service</title>
<g id="a_edge89"><a xlink:title="{&#10; &#160;experiment_id: uuid,&#10; &#160;csvDefinition: [{ trial_type: string, file_name: string, description?: string }],&#10; &#160;files: [{ fileName: string, mimeType: string, contentBase64: string }]&#10;}&#10;">
<path fill="none" stroke="black" d="M3197.92,-2617C3295.55,-2617 3419.89,-2617 3419.89,-2617 3419.89,-2617 3419.89,-2678.79 3419.89,-2678.79"/>
<polygon fill="black" stroke="black" points="3416.39,-2678.79 3419.89,-2688.79 3423.39,-2678.79 3416.39,-2678.79"/>
</a>
</g>
<text text-anchor="middle" x="3503.3" y="-2642" font-family="Arial" font-size="10.00">AMQP message (JSON)</text>
<text text-anchor="middle" x="3503.3" y="-2631" font-family="Arial" font-size="10.00">{</text>
<text text-anchor="middle" x="3503.3" y="-2620" font-family="Arial" font-size="10.00"> &#160;experiment_id: uuid,</text>
<text text-anchor="middle" x="3503.3" y="-2609" font-family="Arial" font-size="10.00"> &#160;csvDefinition: [{ trial_type: string, file_name: string, description?: string }],</text>
<text text-anchor="middle" x="3503.3" y="-2598" font-family="Arial" font-size="10.00"> &#160;files: [{ fileName: string, mimeType: string, contentBase64: string }]</text>
<text text-anchor="middle" x="3503.3" y="-2587" font-family="Arial" font-size="10.00">}</text>
</g>
</g>
</svg>
